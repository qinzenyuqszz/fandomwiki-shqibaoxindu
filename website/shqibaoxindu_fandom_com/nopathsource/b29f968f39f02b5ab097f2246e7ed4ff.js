/*! For license information please see index.js.LICENSE.txt */
(()=>{var t,e,n={38:(t,e,n)=>{"use strict";n.d(e,{C:()=>i});class i{static getURLSearchParams(){const t=window.location.search.substring(1);return new URLSearchParams(t)}static get(t){return i.getURLSearchParams().get(t)}static stringify(t){const e=new URLSearchParams(t);return e.sort(),e.toString()}}},144:(t,e,n)=>{"use strict";n.d(e,{O:()=>c,V:()=>l});var i=n(635),r=n(38),o=n(242),s=n(393),a=n(978);class c{transform(t,e){return t.setLoggerGroup(e)}}let l=class{constructor(t){var e,n;this.logGroup="Global",this.debugGroup=this.getDebugGroup()||"",this.groups=this.debugGroup.split(","),this.initTime=null!==(n=null===(e=null==t?void 0:t.performance)||void 0===e?void 0:e.timeOrigin)&&void 0!==n?n:Date.now()}setLoggerGroup(t){return this.logGroup=t,this}getTimeDelta(){return Date.now()-this.initTime}getDebugGroup(){return r.C.get("identity_debug")}getTimeDeltaFixed(){return(this.getTimeDelta()/1e3).toFixed(4)}info(...t){this.loggingEnabled()&&console.info(`${this.getTimeDeltaFixed()}s\t\t [IE] ${this.logGroup}`,t)}warn(...t){this.loggingEnabled()&&console.warn(`${this.getTimeDeltaFixed()}s\t\t [IE] ${this.logGroup}`,t)}error(...t){this.loggingEnabled()&&console.error(`${this.getTimeDeltaFixed()}s\t\t [IE] ${this.logGroup}`,t)}loggingEnabled(){return(0,a.A)()||-1!==this.groups.indexOf(this.logGroup)}};l=(0,i.Cg)([(0,o._G)(),(0,i.Qj)(0,(0,o.WQ)(s.jf))],l)},242:(t,e,n)=>{"use strict";var i;n.d(e,{kL:()=>O,cb:()=>g,WQ:()=>I,MR:()=>M,_G:()=>R,TS:()=>P,Gr:()=>A}),function(t){t[t.Transient=0]="Transient",t[t.Singleton=1]="Singleton",t[t.ResolutionScoped=2]="ResolutionScoped",t[t.ContainerScoped=3]="ContainerScoped"}(i||(i={}));const r=i;var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},o(t,e)};function s(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function a(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(t){r={error:t}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}function l(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(c(arguments[e]));return t}function d(t){return!!t.useClass}function u(t){return!!t.useFactory}var h=function(){function t(t){this.wrap=t,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return t.prototype.createProxy=function(t){var e,n=this,i=!1;return new Proxy({},this.createHandler((function(){return i||(e=t(n.wrap()),i=!0),e})))},t.prototype.createHandler=function(t){var e={};return this.reflectMethods.forEach((function(n){e[n]=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return e[0]=t(),Reflect[n].apply(void 0,l(e))}})),e},t}();function g(t){if(void 0===t)throw new Error("Attempt to `delay` undefined. Constructor must be wrapped in a callback");return new h(t)}function p(t){return"string"==typeof t||"symbol"==typeof t}function f(t){return"object"==typeof t&&"token"in t&&"transform"in t}function v(t){return!!t.useToken}function m(t){return null!=t.useValue}const y=function(){function t(){this._registryMap=new Map}return t.prototype.entries=function(){return this._registryMap.entries()},t.prototype.getAll=function(t){return this.ensure(t),this._registryMap.get(t)},t.prototype.get=function(t){this.ensure(t);var e=this._registryMap.get(t);return e[e.length-1]||null},t.prototype.set=function(t,e){this.ensure(t),this._registryMap.get(t).push(e)},t.prototype.setAll=function(t,e){this._registryMap.set(t,e)},t.prototype.has=function(t){return this.ensure(t),this._registryMap.get(t).length>0},t.prototype.clear=function(){this._registryMap.clear()},t.prototype.ensure=function(t){this._registryMap.has(t)||this._registryMap.set(t,[])},t}(),w=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(y),C=function(){this.scopedResolutions=new Map};var b=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(y),k=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return s(e,t),e}(y);const S=function(){this.preResolution=new b,this.postResolution=new k};var T=new Map,Q=function(){function t(t){this.parent=t,this._registry=new w,this.interceptors=new S,this.disposed=!1,this.disposables=new Set}return t.prototype.register=function(t,e,n){var i;if(void 0===n&&(n={lifecycle:r.Transient}),this.ensureNotDisposed(),i=function(t){return d(t)||m(t)||v(t)||u(t)}(e)?e:{useClass:e},v(i))for(var o=[t],s=i;null!=s;){var a=s.useToken;if(o.includes(a))throw new Error("Token registration cycle detected! "+l(o,[a]).join(" -> "));o.push(a);var c=this._registry.get(a);s=c&&v(c.provider)?c.provider:null}if((n.lifecycle===r.Singleton||n.lifecycle==r.ContainerScoped||n.lifecycle==r.ResolutionScoped)&&(m(i)||u(i)))throw new Error('Cannot use lifecycle "'+r[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(t,{provider:i,options:n}),this},t.prototype.registerType=function(t,e){return this.ensureNotDisposed(),p(e)?this.register(t,{useToken:e}):this.register(t,{useClass:e})},t.prototype.registerInstance=function(t,e){return this.ensureNotDisposed(),this.register(t,{useValue:e})},t.prototype.registerSingleton=function(t,e){if(this.ensureNotDisposed(),p(t)){if(p(e))return this.register(t,{useToken:e},{lifecycle:r.Singleton});if(e)return this.register(t,{useClass:e},{lifecycle:r.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=t;return e&&!p(e)&&(n=e),this.register(t,{useClass:n},{lifecycle:r.Singleton})},t.prototype.resolve=function(t,e){void 0===e&&(e=new C),this.ensureNotDisposed();var n=this.getRegistration(t);if(!n&&p(t))throw new Error('Attempted to resolve unregistered dependency token: "'+t.toString()+'"');if(this.executePreResolutionInterceptor(t,"Single"),n){var i=this.resolveRegistration(n,e);return this.executePostResolutionInterceptor(t,i,"Single"),i}if(function(t){return"function"==typeof t||t instanceof h}(t))return i=this.construct(t,e),this.executePostResolutionInterceptor(t,i,"Single"),i;throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},t.prototype.executePreResolutionInterceptor=function(t,e){var n,i;if(this.interceptors.preResolution.has(t)){var r=[];try{for(var o=a(this.interceptors.preResolution.getAll(t)),s=o.next();!s.done;s=o.next()){var c=s.value;"Once"!=c.options.frequency&&r.push(c),c.callback(t,e)}}catch(t){n={error:t}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(t,r)}},t.prototype.executePostResolutionInterceptor=function(t,e,n){var i,r;if(this.interceptors.postResolution.has(t)){var o=[];try{for(var s=a(this.interceptors.postResolution.getAll(t)),c=s.next();!c.done;c=s.next()){var l=c.value;"Once"!=l.options.frequency&&o.push(l),l.callback(t,e,n)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(t,o)}},t.prototype.resolveRegistration=function(t,e){if(this.ensureNotDisposed(),t.options.lifecycle===r.ResolutionScoped&&e.scopedResolutions.has(t))return e.scopedResolutions.get(t);var n,i=t.options.lifecycle===r.Singleton,o=t.options.lifecycle===r.ContainerScoped,s=i||o;return n=m(t.provider)?t.provider.useValue:v(t.provider)?s?t.instance||(t.instance=this.resolve(t.provider.useToken,e)):this.resolve(t.provider.useToken,e):d(t.provider)?s?t.instance||(t.instance=this.construct(t.provider.useClass,e)):this.construct(t.provider.useClass,e):u(t.provider)?t.provider.useFactory(this):this.construct(t.provider,e),t.options.lifecycle===r.ResolutionScoped&&e.scopedResolutions.set(t,n),n},t.prototype.resolveAll=function(t,e){var n=this;void 0===e&&(e=new C),this.ensureNotDisposed();var i=this.getAllRegistrations(t);if(!i&&p(t))throw new Error('Attempted to resolve unregistered dependency token: "'+t.toString()+'"');if(this.executePreResolutionInterceptor(t,"All"),i){var r=i.map((function(t){return n.resolveRegistration(t,e)}));return this.executePostResolutionInterceptor(t,r,"All"),r}var o=[this.construct(t,e)];return this.executePostResolutionInterceptor(t,o,"All"),o},t.prototype.isRegistered=function(t,e){return void 0===e&&(e=!1),this.ensureNotDisposed(),this._registry.has(t)||e&&(this.parent||!1)&&this.parent.isRegistered(t,!0)},t.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},t.prototype.clearInstances=function(){var t,e;this.ensureNotDisposed();try{for(var n=a(this._registry.entries()),i=n.next();!i.done;i=n.next()){var r=c(i.value,2),o=r[0],s=r[1];this._registry.setAll(o,s.filter((function(t){return!m(t.provider)})).map((function(t){return t.instance=void 0,t})))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.createChildContainer=function(){var e,n;this.ensureNotDisposed();var i=new t(this);try{for(var o=a(this._registry.entries()),s=o.next();!s.done;s=o.next()){var l=c(s.value,2),d=l[0],u=l[1];u.some((function(t){return t.options.lifecycle===r.ContainerScoped}))&&i._registry.setAll(d,u.map((function(t){return t.options.lifecycle===r.ContainerScoped?{provider:t.provider,options:t.options}:t})))}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}return i},t.prototype.beforeResolution=function(t,e,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.preResolution.set(t,{callback:e,options:n})},t.prototype.afterResolution=function(t,e,n){void 0===n&&(n={frequency:"Always"}),this.interceptors.postResolution.set(t,{callback:e,options:n})},t.prototype.dispose=function(){return t=this,e=void 0,i=function(){var t;return function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}(this,(function(e){switch(e.label){case 0:return this.disposed=!0,t=[],this.disposables.forEach((function(e){var n=e.dispose();n&&t.push(n)})),[4,Promise.all(t)];case 1:return e.sent(),[2]}}))},new((n=void 0)||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}));var t,e,n,i},t.prototype.getRegistration=function(t){return this.isRegistered(t)?this._registry.get(t):this.parent?this.parent.getRegistration(t):null},t.prototype.getAllRegistrations=function(t){return this.isRegistered(t)?this._registry.getAll(t):this.parent?this.parent.getAllRegistrations(t):null},t.prototype.construct=function(t,e){var n=this;if(t instanceof h)return t.createProxy((function(t){return n.resolve(t,e)}));var i,r=function(){var i=T.get(t);if(!i||0===i.length){if(0===t.length)return new t;throw new Error('TypeInfo not known for "'+t.name+'"')}var r=i.map(n.resolveParams(e,t));return new(t.bind.apply(t,l([void 0],r)))}();return"function"!=typeof(i=r).dispose||i.dispose.length>0||this.disposables.add(r),r},t.prototype.resolveParams=function(t,e){var n=this;return function(i,r){var o,s,a,d;try{return"object"==typeof(d=i)&&"token"in d&&"multiple"in d?f(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,l([n.resolveAll(i.token)],i.transformArgs)):(s=n.resolve(i.transform)).transform.apply(s,l([n.resolve(i.token,t)],i.transformArgs)):i.multiple?n.resolveAll(i.token):n.resolve(i.token,t):f(i)?(a=n.resolve(i.transform,t)).transform.apply(a,l([n.resolve(i.token,t)],i.transformArgs)):n.resolve(i,t)}catch(t){throw new Error(function(t,e,n){var i,r,o,s,a=c(t.toString().match(/constructor\(([\w, ]+)\)/)||[],2)[1];return i="Cannot inject the dependency "+(s=e,(null===(o=void 0===a?null:a)?"at position #"+s:'"'+o.split(",")[s].trim()+'" at position #'+s)+' of "')+t.name+'" constructor. Reason:',void 0===r&&(r="    "),l([i],n.message.split("\n").map((function(t){return r+t}))).join("\n")}(e,r,t))}}},t.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},t}(),O=new Q,j="injectionTokens";function E(t,e){return function(n,i,r){var o=Reflect.getOwnMetadata(j,n)||{};o[r]=e?{token:t,transform:e.transformToken,transformArgs:e.args||[]}:t,Reflect.defineMetadata(j,o,n)}}const I=function(t){return E(t)},R=function(){return function(t){T.set(t,function(t){var e=Reflect.getMetadata("design:paramtypes",t)||[],n=Reflect.getOwnMetadata(j,t)||{};return Object.keys(n).forEach((function(t){e[+t]=n[t]})),e}(t))}},A=function(){return function(t){R()(t),O.registerSingleton(t)}},M=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];return E(t,{transformToken:e,args:n})};function P(t){var e;return function(n){return null==e&&(e=t(n)),e}}if("undefined"==typeof Reflect||!Reflect.getMetadata)throw new Error("tsyringe requires a reflect polyfill. Please add 'import \"reflect-metadata\"' to the top of your entry point.")},393:(t,e,n)=>{"use strict";n.d(e,{AZ:()=>i,jf:()=>o,kW:()=>r,kk:()=>s});const i=Symbol("COOKIES"),r=Symbol("NAVIGATOR"),o=Symbol("WINDOW"),s=Symbol("UUID");Symbol("SENTRY")},569:(t,e,n)=>{"use strict";n.d(e,{e:()=>i});const i=["ai","aw","ax","at","be","bg","bm","vg","bq","ky","hr","cw","cy","cz","dk","ee","fk","fo","fi","fr","gf","pf","tf","de","gi","gr","gl","gp","hu","is","ie","im","it","re","lv","li","lt","lu","mq","mt","yt","ms","nl","nc","no","pn","pl","pt","ro","bl","sh","mf","pm","bq","sx","sk","si","es","se","ch","tc","gb","uk","wf","ad","br","cn"]},635:(t,e,n)=>{"use strict";function i(t,e,n,i){var r,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(s=(o<3?r(s):o>3?r(e,n,s):r(e,n))||s);return o>3&&s&&Object.defineProperty(e,n,s),s}function r(t,e){return function(n,i){e(n,i,t)}}function o(t,e,n,i){return new(n||(n=Promise))((function(r,o){function s(t){try{c(i.next(t))}catch(t){o(t)}}function a(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((i=i.apply(t,e||[])).next())}))}n.d(e,{Cg:()=>i,Qj:()=>r,sH:()=>o}),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError},695:(t,e,n)=>{"use strict";n.d(e,{u:()=>c});var i=n(635),r=n(242),o=n(393),s=n(569);class a extends Error{constructor(t){super(t),this.name="GeoJsonParseException"}}let c=class{constructor(t,e){this.cookiesManager=t,this.window=e}get(){return this.geoData||(this.geoData=this.getGeoData()),this.geoData}set(t){this.geoData=t}getGeoData(){var t;if(void 0!==(null===(t=this.window.ads)||void 0===t?void 0:t.geo))return this.window.ads.geo;const e=this.getGeoDataFromCookie();return Object.keys(e).length?e:this.getGeoDataFromOneTrust()}getGeoDataFromCookie(){const t=this.cookiesManager.get("Geo");if(!t)return{};const e=decodeURIComponent(t);try{return JSON.parse(e)}catch(t){throw new a(`Failed to parse Geo cookie: ${t}`)}}getGeoDataFromOneTrust(){return this.window.OneTrust&&this.window.OneTrust.getGeolocationData()?{country:this.window.OneTrust.getGeolocationData().country}:{}}getCountryCode(){var t,e;return null===(e=null===(t=this.get())||void 0===t?void 0:t.country)||void 0===e?void 0:e.toLowerCase()}getRegionCode(){var t,e;return null===(e=null===(t=this.get())||void 0===t?void 0:t.region)||void 0===e?void 0:e.toLowerCase()}getContinentCode(){var t,e;return null===(e=null===(t=this.get())||void 0===t?void 0:t.continent)||void 0===e?void 0:e.toLowerCase()}isGdprCountry(){return s.e.includes(this.getCountryCode())}};c=(0,i.Cg)([(0,r.Gr)(),(0,i.Qj)(0,(0,r.WQ)(o.AZ)),(0,i.Qj)(1,(0,r.WQ)(o.jf))],c)},698:(t,e,n)=>{var i;!function(t){!function(){var e="object"==typeof globalThis?globalThis:"object"==typeof n.g?n.g:"object"==typeof self?self:"object"==typeof this?this:function(){throw new ReferenceError("globalThis could not be found. Please polyfill globalThis before loading this module.")}(),i=r(t);function r(t,e){return function(n,i){Object.defineProperty(t,n,{configurable:!0,writable:!0,value:i}),e&&e(n,i)}}void 0!==e.Reflect&&(i=r(e.Reflect,i)),function(t,e){var n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:D("Symbol.toPrimitive not found."),r=n&&void 0!==Symbol.iterator?Symbol.iterator:D("Symbol.iterator not found."),o=Object.getPrototypeOf(Function),s="function"==typeof Map&&"function"==typeof Map.prototype.entries?Map:D("A valid Map constructor could not be found."),a="function"==typeof Set&&"function"==typeof Set.prototype.entries?Set:D("A valid Set constructor could not be found."),c="function"==typeof WeakMap?WeakMap:D("A valid WeakMap constructor could not be found."),l=n?Symbol.for("@reflect-metadata:registry"):void 0,d=function(){var t;return!C(l)&&k(e.Reflect)&&Object.isExtensible(e.Reflect)&&(t=e.Reflect[l]),C(t)&&(t=function(){var t,n,i,r;C(l)||void 0===e.Reflect||l in e.Reflect||"function"!=typeof e.Reflect.defineMetadata||(t=function(t){var e=t.defineMetadata,n=t.hasOwnMetadata,i=t.getOwnMetadata,r=t.getOwnMetadataKeys,o=t.deleteMetadata,s=new c;return{isProviderFor:function(t,e){var n=s.get(t);return!(C(n)||!n.has(e))||!!r(t,e).length&&(C(n)&&(n=new a,s.set(t,n)),n.add(e),!0)},OrdinaryDefineOwnMetadata:e,OrdinaryHasOwnMetadata:n,OrdinaryGetOwnMetadata:i,OrdinaryOwnMetadataKeys:r,OrdinaryDeleteMetadata:o}}(e.Reflect));var o=new c,d={registerProvider:u,getProvider:g,setProvider:f};return d;function u(e){if(!Object.isExtensible(d))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case t===e:break;case C(n):n=e;break;case n===e:break;case C(i):i=e;break;case i===e:break;default:void 0===r&&(r=new a),r.add(e)}}function h(e,o){if(!C(n)){if(n.isProviderFor(e,o))return n;if(!C(i)){if(i.isProviderFor(e,o))return n;if(!C(r))for(var s=R(r);;){var a=M(s);if(!a)return;var c=A(a);if(c.isProviderFor(e,o))return P(s),c}}}if(!C(t)&&t.isProviderFor(e,o))return t}function g(t,e){var n,i=o.get(t);return C(i)||(n=i.get(e)),C(n)?(C(n=h(t,e))||(C(i)&&(i=new s,o.set(t,i)),i.set(e,n)),n):n}function p(t){if(C(t))throw new TypeError;return n===t||i===t||!C(r)&&r.has(t)}function f(t,e,n){if(!p(n))throw new Error("Metadata provider not registered.");var i=g(t,e);if(i!==n){if(!C(i))return!1;var r=o.get(t);C(r)&&(r=new s,o.set(t,r)),r.set(e,n)}return!0}}()),!C(l)&&k(e.Reflect)&&Object.isExtensible(e.Reflect)&&Object.defineProperty(e.Reflect,l,{enumerable:!1,configurable:!1,writable:!1,value:t}),t}(),u=function(t){var e=new c,n={isProviderFor:function(t,n){var i=e.get(t);return!C(i)&&i.has(n)},OrdinaryDefineOwnMetadata:function(t,e,n,r){i(n,r,!0).set(t,e)},OrdinaryHasOwnMetadata:function(t,e,n){var r=i(e,n,!1);return!C(r)&&T(r.has(t))},OrdinaryGetOwnMetadata:function(t,e,n){var r=i(e,n,!1);if(!C(r))return r.get(t)},OrdinaryOwnMetadataKeys:function(t,e){var n=[],r=i(t,e,!1);if(C(r))return n;for(var o=R(r.keys()),s=0;;){var a=M(o);if(!a)return n.length=s,n;var c=A(a);try{n[s]=c}catch(t){try{P(o)}finally{throw t}}s++}},OrdinaryDeleteMetadata:function(t,n,r){var o=i(n,r,!1);if(C(o))return!1;if(!o.delete(t))return!1;if(0===o.size){var s=e.get(n);C(s)||(s.delete(r),0===s.size&&e.delete(s))}return!0}};return d.registerProvider(n),n;function i(i,r,o){var a=e.get(i),c=!1;if(C(a)){if(!o)return;a=new s,e.set(i,a),c=!0}var l=a.get(r);if(C(l)){if(!o)return;if(l=new s,a.set(r,l),!t.setProvider(i,r,n))throw a.delete(r),c&&e.delete(i),new Error("Wrong provider for target.")}return l}}(d);function h(t,e,n){if(g(t,e,n))return!0;var i=x(e);return!b(i)&&h(t,i,n)}function g(t,e,n){var i=_(e,n,!1);return!C(i)&&T(i.OrdinaryHasOwnMetadata(t,e,n))}function p(t,e,n){if(g(t,e,n))return f(t,e,n);var i=x(e);return b(i)?void 0:p(t,i,n)}function f(t,e,n){var i=_(e,n,!1);if(!C(i))return i.OrdinaryGetOwnMetadata(t,e,n)}function v(t,e,n,i){_(n,i,!0).OrdinaryDefineOwnMetadata(t,e,n,i)}function m(t,e){var n=y(t,e),i=x(t);if(null===i)return n;var r=m(i,e);if(r.length<=0)return n;if(n.length<=0)return r;for(var o=new a,s=[],c=0,l=n;c<l.length;c++){var d=l[c];o.has(d)||(o.add(d),s.push(d))}for(var u=0,h=r;u<h.length;u++)d=h[u],o.has(d)||(o.add(d),s.push(d));return s}function y(t,e){var n=_(t,e,!1);return n?n.OrdinaryOwnMetadataKeys(t,e):[]}function w(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function C(t){return void 0===t}function b(t){return null===t}function k(t){return"object"==typeof t?null!==t:"function"==typeof t}function S(t,e){switch(w(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=I(t,i);if(void 0!==r){var o=r.call(t,n);if(k(o))throw new TypeError;return o}return function(t,e){if("string"===e){var n=t.toString;if(j(n)&&!k(r=n.call(t)))return r;if(j(i=t.valueOf)&&!k(r=i.call(t)))return r}else{var i;if(j(i=t.valueOf)&&!k(r=i.call(t)))return r;var r,o=t.toString;if(j(o)&&!k(r=o.call(t)))return r}throw new TypeError}(t,"default"===n?"number":n)}function T(t){return!!t}function Q(t){var e=S(t,3);return"symbol"==typeof e?e:function(t){return""+t}(e)}function O(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function j(t){return"function"==typeof t}function E(t){return"function"==typeof t}function I(t,e){var n=t[e];if(null!=n){if(!j(n))throw new TypeError;return n}}function R(t){var e=I(t,r);if(!j(e))throw new TypeError;var n=e.call(t);if(!k(n))throw new TypeError;return n}function A(t){return t.value}function M(t){var e=t.next();return!e.done&&e}function P(t){var e=t.return;e&&e.call(t)}function x(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===o)return e;if(e!==o)return e;var n=t.prototype,i=n&&Object.getPrototypeOf(n);if(null==i||i===Object.prototype)return e;var r=i.constructor;return"function"!=typeof r||r===t?e:r}function D(t){throw t}function _(t,e,n){var i=d.getProvider(t,e);if(!C(i))return i;if(n){if(d.setProvider(t,e,u))return u;throw new Error("Illegal state.")}}t("decorate",(function(t,e,n,i){if(C(n)){if(!O(t))throw new TypeError;if(!E(e))throw new TypeError;return function(t,e){for(var n=t.length-1;n>=0;--n){var i=(0,t[n])(e);if(!C(i)&&!b(i)){if(!E(i))throw new TypeError;e=i}}return e}(t,e)}if(!O(t))throw new TypeError;if(!k(e))throw new TypeError;if(!k(i)&&!C(i)&&!b(i))throw new TypeError;return b(i)&&(i=void 0),function(t,e,n,i){for(var r=t.length-1;r>=0;--r){var o=(0,t[r])(e,n,i);if(!C(o)&&!b(o)){if(!k(o))throw new TypeError;i=o}}return i}(t,e,n=Q(n),i)})),t("metadata",(function(t,e){return function(n,i){if(!k(n))throw new TypeError;if(!C(i)&&!function(t){switch(w(t)){case 3:case 4:return!0;default:return!1}}(i))throw new TypeError;v(t,e,n,i)}})),t("defineMetadata",(function(t,e,n,i){if(!k(n))throw new TypeError;return C(i)||(i=Q(i)),v(t,e,n,i)})),t("hasMetadata",(function(t,e,n){if(!k(e))throw new TypeError;return C(n)||(n=Q(n)),h(t,e,n)})),t("hasOwnMetadata",(function(t,e,n){if(!k(e))throw new TypeError;return C(n)||(n=Q(n)),g(t,e,n)})),t("getMetadata",(function(t,e,n){if(!k(e))throw new TypeError;return C(n)||(n=Q(n)),p(t,e,n)})),t("getOwnMetadata",(function(t,e,n){if(!k(e))throw new TypeError;return C(n)||(n=Q(n)),f(t,e,n)})),t("getMetadataKeys",(function(t,e){if(!k(t))throw new TypeError;return C(e)||(e=Q(e)),m(t,e)})),t("getOwnMetadataKeys",(function(t,e){if(!k(t))throw new TypeError;return C(e)||(e=Q(e)),y(t,e)})),t("deleteMetadata",(function(t,e,n){if(!k(e))throw new TypeError;C(n)||(n=Q(n));var i=_(e,n,!1);return!C(i)&&i.OrdinaryDeleteMetadata(t,e,n)}))}(i,e),void 0===e.Reflect&&(e.Reflect=t)}()}(i||(i={}))},799:(t,e,n)=>{"use strict";function i(t,e=10,n=50,i=0){return new Promise(((r,o)=>{i?function(t,e,n,i,r,o){let s=0;const a=()=>t()?r():s>=e?o():(s++,void setTimeout(a,n+i*s));setTimeout(a,n)}(t,e,n,i,r,o):function(t,e,n,i,r){let o=0;const s=setInterval((()=>{t()&&(clearInterval(s),i()),o++>e&&(clearInterval(s),r())}),n)}(t,e,n,r,o)}))}n.d(e,{f:()=>i})},978:(t,e,n)=>{"use strict";n.d(e,{A:()=>r});var i=n(38);function r(){return"1"===i.C.get("identity_debug")}}},i={};function r(t){var e=i[t];if(void 0!==e)return e.exports;var o=i[t]={exports:{}};return n[t](o,o.exports,r),o.exports}r.m=n,r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.f={},r.e=t=>Promise.all(Object.keys(r.f).reduce(((e,n)=>(r.f[n](t,e),e)),[])),r.u=t=>({319:"static-consents",482:"fanatical-consents"}[t]+".js"),r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="identity-engine:",r.l=(n,i,o,s)=>{if(t[n])t[n].push(i);else{var a,c;if(void 0!==o)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==n||u.getAttribute("data-webpack")==e+o){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",e+o),a.src=n),t[n]=[i];var h=(e,i)=>{a.onerror=a.onload=null,clearTimeout(g);var r=t[n];if(delete t[n],a.parentNode&&a.parentNode.removeChild(a),r&&r.forEach((t=>t(i))),e)return e(i)},g=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var n=e.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=n[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),(()=>{var t={57:0};r.f.j=(e,n)=>{var i=r.o(t,e)?t[e]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise(((n,r)=>i=t[e]=[n,r]));n.push(i[2]=o);var s=r.p+r.u(e),a=new Error;r.l(s,(n=>{if(r.o(t,e)&&(0!==(i=t[e])&&(t[e]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),s=n&&n.target&&n.target.src;a.message="Loading chunk "+e+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}}),"chunk-"+e,e)}};var e=(e,n)=>{var i,o,[s,a,c]=n,l=0;if(s.some((e=>0!==t[e]))){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);c&&c(r)}for(e&&e(n);l<s.length;l++)o=s[l],r.o(t,o)&&t[o]&&t[o][0](),t[o]=0},n=self.webpackChunkidentity_engine=self.webpackChunkidentity_engine||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{"use strict";var t=r(635),e=(r(698),r(242));function n(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}var i,o=function t(e,i){function r(t,r,o){if("undefined"!=typeof document){"number"==typeof(o=n({},i,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in o)o[a]&&(s+="; "+a,!0!==o[a]&&(s+="="+o[a].split(";")[0]));return document.cookie=t+"="+e.write(r,t)+s}}return Object.create({set:r,get:function(t){if("undefined"!=typeof document&&(!arguments.length||t)){for(var n=document.cookie?document.cookie.split("; "):[],i={},r=0;r<n.length;r++){var o=n[r].split("="),s=o.slice(1).join("=");try{var a=decodeURIComponent(o[0]);if(i[a]=e.read(s,a),t===a)break}catch(t){}}return t?i[t]:i}},remove:function(t,e){r(t,"",n({},e,{expires:-1}))},withAttributes:function(e){return t(this.converter,n({},this.attributes,e))},withConverter:function(e){return t(n({},this.converter,e),this.attributes)}},{attributes:{value:Object.freeze(i)},converter:{value:Object.freeze(e)}})}({read:function(t){return'"'===t[0]&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),s=r(144);class a extends Error{constructor(t){super(t),this.name=this.constructor.name}}let c=i=class{get(e){return(0,t.sH)(this,arguments,void 0,(function*(t,e={mode:"cors"},n=i.DEFAULT_TIMEOUT){return this.fetch(t,"GET",e,n)}))}put(e,n){return(0,t.sH)(this,arguments,void 0,(function*(t,e,n={mode:"cors"}){return this.fetch(t,"PUT",n,0,e)}))}fetch(e,n){return(0,t.sH)(this,arguments,void 0,(function*(t,e,n={mode:"cors"},i=0,r){let o,s;if(i>0){const t=new AbortController;s=setTimeout((()=>t.abort(new DOMException("signal is aborted due to a timeout","AbortError"))),i),o=t.signal}try{const i=yield fetch(t,Object.assign({method:e,signal:o,headers:r?{"Content-Type":"application/json"}:void 0,keepalive:!0,body:r?JSON.stringify(r):void 0},n));if(void 0!==s&&clearTimeout(s),!i.ok)throw new a(`HTTP error ${t}! Status: ${i.status}`);return i}catch(e){if(e instanceof a)throw e;throw new a(`HTTP error ${e} while sending request to ${t}!`)}}))}};c.DEFAULT_TIMEOUT=1e3,c=i=(0,t.Cg)([(0,e._G)()],c);var l=r(393),d=r(695);let u=class{constructor(t){this.window=t}get(){var t;return null===(t=this.window.ads)||void 0===t?void 0:t.context}};u=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(l.jf))],u);let h=class{constructor(t){this.adsContext=t}get(){var t;return"dev"===(null===(t=this.adsContext.get())||void 0===t?void 0:t.env)?"https://services.fandom-dev."+(location.hostname.match(/(?!\.)(pl|us)$/)||["us"])[0]+"/":"https://services.fandom.com/"}};h=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(u))],h);class g extends Error{constructor(t){super(t),this.name="GeoCookieException"}}let p=class{constructor(t,e,n,i,r){this.cookiesManager=t,this.httpClient=e,this.logger=n,this.geo=i,this.serviceBaseUrl=r,this.geoIPUrl=this.serviceBaseUrl.get()+"geoip/location"}setGeoCookieIfNotExist(){return(0,t.sH)(this,void 0,void 0,(function*(){if(this.cookiesManager.get("Geo"))this.logger.info("Geo cookie already exists");else try{const t=yield this.httpClient.get(this.geoIPUrl),{country_code:e,region:n,continent_code:i}=yield t.json(),r={country:e,region:n,continent:i},o=JSON.stringify(r);this.cookiesManager.set("Geo",o,{expires:365}),this.geo.set(r),this.logger.info("Geo cookie set")}catch(t){if(t instanceof a)throw new g(`Failed to fetch Geo cookie from pandora: ${t}`);throw new g(`Failed to set Geo cookie: ${t}`)}}))}};var f;p=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.AZ)),(0,t.Qj)(1,(0,e.WQ)(c)),(0,t.Qj)(2,(0,e.MR)(s.V,s.O,"GeoCookie")),(0,t.Qj)(3,(0,e.WQ)(d.u)),(0,t.Qj)(4,(0,e.WQ)(h))],p),function(t){t.F2="f2",t.FUTHEAD="futhead",t.MUTHEAD="muthead",t.GAMESPOT="gamespot",t.COMICVINE="comicvine",t.GAMEFAQS="gamefaqs",t.METACRITIC="metacritic",t.METACRITIC_NEUTRON="metacritic-neutron",t.TVGUIDE="tvguide",t.TVGUIDE_MTC="tvguide-mtc",t.GIANTBOMB="giantbomb",t.FANATICAL="fanatical",t.FANDOMDESKTOP="fandomdesktop",t.FANDOMMOBILE="fandommobile"}(f||(f={}));let v=class{constructor(t){this.adsContext=t}get(){var t;const e=this.adsContext.get();return(null!==(t=null==e?void 0:e.platform)&&void 0!==t?t:null==e?void 0:e.app)||this.detectPlatform()}detectPlatform(){var t,e,n;return void 0!==window.mw&&void 0!==(null===(n=null===(e=null===(t=window.ads)||void 0===t?void 0:t.context)||void 0===e?void 0:e.opts)||void 0===n?void 0:n.platformName)?window.ads.context.opts.platformName:this.checkHostname()}checkHostname(){const{hostname:t,pathname:e}=window.location;switch(!0){case t.includes("fandom"):return f.F2;case t.includes("futhead"):return f.FUTHEAD;case t.includes("muthead"):return f.MUTHEAD;case t.includes("gamespot"):return t.includes("comicvine")?f.COMICVINE:t.includes("gamefaqs")?f.GAMEFAQS:f.GAMESPOT;case t.includes("metacritic"):return e.includes("news")?f.METACRITIC_NEUTRON:f.METACRITIC;case t.includes("tvguide"):return f.TVGUIDE;case t.includes("giantbomb"):return f.GIANTBOMB;case t.includes("fanatical"):return f.FANATICAL;default:return f.FANDOMDESKTOP}}};v=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(u))],v);let m=class{recognizeChromiumBuild(t,e){const n=e.match(/\b(OPR|Edg)\/(\d+)/);return null!==n?n.slice(1).join(" ").replace("OPR","Opera").replace("Edg","Edge"):"Chrome "+t}recognizeIEBuild(t){return`IE ${(/\brv[ :]+(\d+)/g.exec(t)||[""])[1]||""}`}getBrowserNameAndVersion(t){const[,e,n]=t.match(/(opera|chrome|safari|firefox|msie|trident|CriOS(?=\/))\/?\s*(\d+)/i)||[];return[e,n]}recognizeDefaultBrowser(t,e,n,i,r){const o=r?[i,r]:[e,n,"-?"],s=t.match(/version\/(\d+)/i);return null!==s&&o.splice(1,1,s[1]),o.join(" ")}getBrowser(){const{appName:t,appVersion:e,userAgent:n}=window.navigator,[i,r]=this.getBrowserNameAndVersion(n);return/trident/i.test(i)?this.recognizeIEBuild(n):"Chrome"===i||"CriOS"===i?this.recognizeChromiumBuild(r,n):this.recognizeDefaultBrowser(n,t,e,i,r)}};m=(0,t.Cg)([(0,e.Gr)()],m);let y=class{constructor(t,e){this.platform=e,this.testRegex=/Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i,this.userAgent=t.userAgent}getDeviceType(){const t=this.platform.get();return t===f.FANDOMDESKTOP?"desktop":t===f.FANDOMMOBILE||this.testRegex.test(this.userAgent)?"smartphone":"desktop"}};y=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.kW)),(0,t.Qj)(1,(0,e.WQ)(v))],y);let w=class{constructor(t,e,n,i){this.browser=t,this.device=e,this.platform=n,this.geo=i,this.tagsAlreadySet=!1}isSupported(){return[f.FANDOMDESKTOP,f.FANDOMMOBILE].includes(this.platform.get())}setTags(t){var e,n,i;this.tagsAlreadySet||(t.setTags({browser:this.browser.getBrowser(),device:this.device.getDeviceType(),platform:this.platform.get(),geo_country:null!==(e=this.geo.getCountryCode())&&void 0!==e?e:"",geo_continent:null!==(n=this.geo.getContinentCode())&&void 0!==n?n:"",geo_region:null!==(i=this.geo.getRegionCode())&&void 0!==i?i:""}),this.tagsAlreadySet=!0)}};w=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(m)),(0,t.Qj)(1,(0,e.WQ)(y)),(0,t.Qj)(2,(0,e.WQ)(v)),(0,t.Qj)(3,(0,e.WQ)(d.u))],w);const C=(t=window)=>Boolean(t.FANDOM_ODYSSEY);function b(n){return(0,t.sH)(this,void 0,void 0,(function*(){if(!C(window))return;const t=yield function(){const t=e.kL.resolve(w);return new Promise((e=>{t.isSupported()||e(null),window.fandomSentry?e(window.fandomSentry):window.addEventListener("fandomSentryLoaded",(()=>{e(window.fandomSentry)}))}))}();t&&(e.kL.resolve(w).setTags(t),t.captureException(n))}))}class k{constructor(t,e){this.__global=!0,this.timestamp=Date.now(),this.name=t.name,this.category=t.category||"[Identity]",this.type=`${this.category} ${t.name}`,Object.assign(this,e)}}const S={category:"[AdEngine OptIn]",name:"set opt in"},T={category:"[AdEngine OptIn]",name:"update opt in"},Q={category:"[IdentityEngine]",name:"Fandom context set"},O={category:"[IdentityEngine]",name:"Identity ready"},j={category:"[AdEngine]",name:"Identity partner data obtained"},E={name:"Age gate result",category:"[Identity]"},I={name:"Page changed",category:"[Platform]"},R={category:"[AdEngine]",name:"Update consent"};var A=function(){return A=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},A.apply(this,arguments)},M={channelId:"default",host:window,coordinatorHost:window.top},P={connect:"connect",connected:"connected"},x="@wikia/post-quecast";function D(t){return t.channelId&&t.libId===x&&t.action&&function(t){return"string"==typeof t.type&&"number"==typeof t.timestamp}(t.action)}function _(t){return!t.data.private}function W(t,e){return t.data.channelId===e}function G(t){return t.data.action}var L=function(){function t(){}return t.make=function(t){return function(t){var e;return t.host===t.coordinatorHost&&!!(null===(e=t.coordinatorHost[x])||void 0===e?void 0:e.callbackConnector)}(t)?t.coordinatorHost[x].callbackConnector:new U({senderHost:t.coordinatorHost,listenerHost:t.host})},t}(),N=function(){function t(t){this.coordinatorHost=t,this.callbacks=[]}return t.prototype.dispatch=function(t){var e=this;if(!D(t))throw new Error("Incorrect object type. Expected PostMessageData, but got "+t);this.callbacks.forEach((function(n){return n({data:t,source:e.coordinatorHost})}))},t.prototype.addListener=function(t){this.callbacks.push(t)},t.prototype.removeListener=function(t){this.callbacks=this.callbacks.filter((function(e){return e!==t}))},t}(),U=function(){function t(t){this.options=t,this.map=new Map}return t.prototype.dispatch=function(t){if(!D(t))throw new Error("Incorrect object type. Expected PostMessageData, but got "+t);this.options.senderHost.postMessage(t,"*")},t.prototype.addListener=function(t){var e=function(e){var n;(n=e)&&n.source&&n.data&&D(n.data)&&t(e)};this.map.set(t,e),this.options.listenerHost.addEventListener("message",e)},t.prototype.removeListener=function(t){var e=this.map.get(t);this.options.listenerHost.removeEventListener("message",e),this.map.delete(t)},t}(),V=function(){function t(t){this.callbacks=[],this.history=[],this.channelId=t.channelId,this.connector=L.make(t),this.setupActions(),this.setupConnection()}return t.prototype.setupActions=function(){this.getHistory(),this.listenEvent()},t.prototype.getHistory=function(){var t=this,e=function(n){if(W(n,t.channelId)&&function(t){return!!t.data.private}(n)){var i=G(n);(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.some((function(e){return t.type===e}))})(i,P.connected)&&(t.connector.removeListener(e),t.handleActions.apply(t,i.history))}};this.connector.addListener(e)},t.prototype.listenEvent=function(){var t=this;this.connector.addListener((function(e){if(W(e,t.channelId)&&_(e)){var n=G(e);t.handleActions(n)}}))},t.prototype.handleActions=function(){for(var t,e=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];(t=this.history).push.apply(t,n),n.forEach((function(t){return e.callbacks.forEach((function(e){return e(t)}))}))},t.prototype.setupConnection=function(){this.connector.dispatch({action:{type:P.connect,timestamp:Date.now()},channelId:this.channelId,private:!0,libId:x})},t.prototype.addListener=function(t){this.history.forEach((function(e){return t(e)})),this.callbacks.push(t)},t.prototype.removeListener=function(t){this.callbacks=this.callbacks.filter((function(e){return e!==t}))},t}(),F=function(){function t(t){void 0===t&&(t={});var e=A(A({},M),t);this.channelId=e.channelId,this.connector=L.make(e)}return t.prototype.dispatch=function(t){this.connector.dispatch({action:A(A({},t),{timestamp:Date.now()}),channelId:this.channelId,private:!0,libId:x})},t}(),B=function(){function t(t){void 0===t&&(t={});var e=A(A({},M),t);this.transmitter=new F(e),this.receiver=new V(e)}return t.prototype.dispatch=function(t){this.transmitter.dispatch(t)},t.prototype.addListener=function(t){this.receiver.addListener(t)},t.prototype.removeListener=function(t){this.receiver.removeListener(t)},t}(),H=function(){function t(t,e){this.channelId=t,this.connectors=new Map,this.history=[],this.connectors.set(e,e[x].callbackConnector)}return t.prototype.addConnection=function(t){this.ensureConnector(t).dispatch({action:this.createConnectedAction(),private:!0,channelId:this.channelId,libId:x})},t.prototype.createConnectedAction=function(){return{type:P.connected,history:this.history,timestamp:Date.now()}},t.prototype.broadcast=function(t){var e=this;this.history.push(t),this.connectors.forEach((function(n){n.dispatch({action:t,channelId:e.channelId,libId:x})}))},t.prototype.ensureConnector=function(t){return this.connectors.has(t)||this.connectors.set(t,new U({senderHost:t,listenerHost:t})),this.connectors.get(t)},t}(),$=function(){function t(t){this.coordinatorHost=t,this.channels=new Map,this.callbackConnector=new N(t),this.postMessageConnector=new U({senderHost:t,listenerHost:t})}return t.prototype.init=function(){var t=this,e=function(e){_(e)||(t.handleConnect(e),t.handleBroadcast(e))};this.callbackConnector.addListener(e),this.postMessageConnector.addListener(e)},t.prototype.handleConnect=function(t){(function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.some((function(e){return t.data.action.type===e}))})(t,P.connect)&&this.ensureChannel(t.data.channelId).addConnection(t.source)},t.prototype.handleBroadcast=function(t){(function(t){return!Object.values(P).some((function(e){return t.data.action.type===e}))})(t)&&this.ensureChannel(t.data.channelId).broadcast(t.data.action)},t.prototype.ensureChannel=function(t){return this.channels.has(t)||this.channels.set(t,new H(t,this.coordinatorHost)),this.channels.get(t)},t}();function q(t){if(void 0===t&&(t=window),!t[x]){var e=new $(t);e.init(),t[x]=e}}let K=class{constructor(t){this.window=t,this.history=new Map;const{channelId:e,coordinatorName:n}=this.getSettings();q(),this.communicator=new B({channelId:e||"default",coordinatorHost:t[n]||top})}emit(t){this.communicator.dispatch(t)}on(t,e){this.communicator.addListener((n=>this.run(n,t,e)))}once(t,e){this.communicator.addListener((n=>this.runOnce(n,t,e)))}getSettings(){return this.window["@wikia/post-quecast-settings"]||{}}run(t,e,n){this.ofType(t,e)&&n(t)}runOnce(t,e,n){const i=e.category+" "+e.name;this.ofType(t,e)&&(this.history.has(i)||(this.history.set(i,!0),n(t)))}ofType(t,e){return t.category===e.category&&t.name===e.name||t.type===e.category+" "+e.name}};K=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf))],K);var z=r(38),Z=r(569);let J=class{static extract(t){const e=t.split(".");if(e.length<2)return t;let n=`.${e[e.length-2]}.${e[e.length-1]}`;return[".co.jp",".co.nz",".co.uk"].indexOf(n)>=0&&(n=`.${e[e.length-3]}${n}`),n}};J=(0,t.Cg)([(0,e._G)()],J);var Y=r(799);let X=class{constructor(){this.loadedAssets=[]}createScript(t,e="text/javascript",n=!0,i=null,r={},o={}){var s;const a=document.createElement("script");if(a.async=n,a.defer=!n,a.type=e,a.src=t,Object.keys(r).forEach((t=>{a.setAttribute(t,r[t])})),Object.keys(o).forEach((t=>{a.dataset[t]=o[t]})),"string"==typeof i){const t=document.getElementsByTagName("script")[0];null===(s=t.parentNode)||void 0===s||s.insertBefore(a,t)}else(i||document.body).append(a);return a}loadScript(t,e="text/javascript",n=!0,i=null,r={},o={}){return new Promise(((s,a)=>{if(this.loadedAssets.includes(t))return s(null);const c=this.createScript(t,e,n,i,r,o);c.onload=s,c.onerror=a})).then((e=>(this.loadedAssets.push(t),e)))}};X=(0,t.Cg)([(0,e._G)()],X);let tt=class{constructor(t,e,n){this.adsContext=t,this.platform=e,this.device=n,this.skinMap={muthead:"turf",futhead:"turf",giantbomb:"giantbomb",gamefaqs:"gamefaqs",gamespot:"gamespot",metacritic:"metacritic","metacritic-neutron":"metacritic_neutron",comicvine:"comicvine",f2:"fandom",tvguide:"tvguide",fandomdesktop:"ucp",fandommobile:"ucp",fanatical:"fanatical"}}get(){var t,e;const n=this.platform.get(),i="desktop"===this.device.getDeviceType()?"desktop":"mobile";return(null===(t=this.adsContext.get())||void 0===t?void 0:t.skin)?`${null!==(e=this.adsContext.get().skin)&&void 0!==e?e:n}_${i}`:this.skinMap[n]?this.skinMap[n]+"_"+i:"unknown"}};tt=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(u)),(0,t.Qj)(1,(0,e.WQ)(v)),(0,t.Qj)(2,(0,e.WQ)(y))],tt);let et=class{constructor(t){this.window=t}get(t,e=null){var n,i,r;return null!==(r=null===(i=null===(n=this.window.mw)||void 0===n?void 0:n.config)||void 0===i?void 0:i.get(t))&&void 0!==r?r:e}};et=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf))],et);let nt=class{constructor(){this.operatingSystem=null}getOperatingSystem(){if(null!==this.operatingSystem)return this.operatingSystem;const{userAgent:t}=window.navigator;return this.operatingSystem="unknown",-1!==t.indexOf("Win")&&(this.operatingSystem="Windows"),-1!==t.indexOf("Mac")&&(this.operatingSystem="OSX"),-1!==t.indexOf("Linux")&&(this.operatingSystem="Linux"),-1!==t.indexOf("Android")&&(this.operatingSystem="Android"),-1!==t.indexOf("like Mac")&&(this.operatingSystem="iOS"),this.operatingSystem}};nt=(0,t.Cg)([(0,e.Gr)()],nt);let it=class{constructor(t){this.cookiesManager=t}getForcedBucket(){return z.C.get("pf_pathfinder_force_bucket")}getWikiaBucket(){const t=this.cookiesManager.get("exp_bucket");if(t)return/^(?:v\d-)?(\d{2})/.test(t)?t:"vN-"+t}getCurrentBucket(){var t,e;const n=this.getForcedBucket();return(null!==(e=(null!==(t=null!=n?n:this.getWikiaBucket())&&void 0!==t?t:"v5-100").split("-").pop())&&void 0!==e?e:"").padStart(2,"0")}};it=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.AZ))],it);let rt=class{constructor(t,e,n,i,r,o,s,a,c){this.logger=t,this.httpClient=e,this.skin=n,this.window=i,this.wikiConfig=r,this.geo=o,this.browser=s,this.operatingSystem=a,this.experimentBucketing=c;const l=new Date;this.startTime=this.getTimeOrigin(),this.tzOffset=l.getTimezoneOffset()}getTimeOrigin(){var t;return null===(t=window.performance)||void 0===t?void 0:t.timeOrigin}getCurrentTimestamp(){return Date.now()}getStartTime(){return this.startTime}getTimezoneOffset(){return this.tzOffset}getTrackingParams(){var t,e,n,i,r,o,s,a,c,l,d,u,h;const g="opted-out",{ready:p,optOut:f}=this.window.fandomCmp,v=p&&!f;return{browser:`${this.operatingSystem.getOperatingSystem()} ${this.browser.getBrowser()}`,browser_ts:this.getCurrentTimestamp(),tz_offset:this.getTimezoneOffset(),country:this.geo.getCountryCode()||"",session_id:v?null===(e=null===(t=this.window.fandomContext)||void 0===t?void 0:t.tracking)||void 0===e?void 0:e.sessionId:g,pv_number:null===(i=null===(n=this.window.fandomContext)||void 0===n?void 0:n.tracking)||void 0===i?void 0:i.pvNumber,pv_number_global:null===(o=null===(r=this.window.fandomContext)||void 0===r?void 0:r.tracking)||void 0===o?void 0:o.pvNumberGlobal,pv_unique_id:null===(a=null===(s=this.window.fandomContext)||void 0===s?void 0:s.tracking)||void 0===a?void 0:a.pvUID,beacon:v?null===(l=null===(c=this.window.fandomContext)||void 0===c?void 0:c.tracking)||void 0===l?void 0:l.beaconId:g,ua:null===(d=this.window.navigator)||void 0===d?void 0:d.userAgent,c:this.wikiConfig.get("wgCityId")||"unknown",ck:this.wikiConfig.get("dsSiteKey")||"unknown",lc:this.wikiConfig.get("wgUserLanguage")||"unknown",s:this.skin.get(),u:v?this.wikiConfig.get("wgUserId")||0:-1,a:(null===(h=null===(u=this.window.fandomContext)||void 0===u?void 0:u.page)||void 0===h?void 0:h.articleId)||-1,x:this.wikiConfig.get("wgDBname")||"unknown",n:this.wikiConfig.get("wgNamespaceNumber")||-1,exp_bucket:v?this.experimentBucketing.getCurrentBucket():g}}getTimeBasedParams(){return{cb:Math.floor(99999*Math.random()),url:document.URL}}buildDataWarehouseUrl(t,e){if(!e)throw this.logger.error("Error building DWH tracking URL"),new Error("Error while building DWH tracking URL - no baseUrl provided");const n=new URLSearchParams(t);return n.sort(),`${e}?${n.toString()}`}sendEvent(t,e){var n;const i=this.buildDataWarehouseUrl(t,e);i&&(null===(n=this.httpClient.get(i,{mode:"cors"},5e3))||void 0===n||n.catch((t=>{this.logger.error("Failed to send data",t)})))}};rt=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"DataWarehouseSender")),(0,t.Qj)(1,(0,e.WQ)(c)),(0,t.Qj)(2,(0,e.WQ)(tt)),(0,t.Qj)(3,(0,e.WQ)(l.jf)),(0,t.Qj)(4,(0,e.WQ)(et)),(0,t.Qj)(5,(0,e.WQ)(d.u)),(0,t.Qj)(6,(0,e.WQ)(m)),(0,t.Qj)(7,(0,e.WQ)(nt)),(0,t.Qj)(8,(0,e.WQ)(it))],rt);let ot=class{constructor(t){this.sender=t}send(t){const e=Object.assign(Object.assign(Object.assign({},t),this.sender.getTimeBasedParams()),this.sender.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/identityinfo")}};var st;ot=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(rt))],ot),function(t){t[t.identity=0]="identity",t[t.loadTime=1]="loadTime",t[t.chromeLabel=2]="chromeLabel",t[t.consents=3]="consents"}(st||(st={}));let at=class{constructor(t){this.sender=t}send(t){const e=Object.assign(Object.assign({event_name:t,load_time:this.sender.getCurrentTimestamp()-this.sender.getStartTime()},this.sender.getTimeBasedParams()),this.sender.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/adengloadtimes")}};at=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(rt))],at);let ct=class{constructor(t){this.sender=t}send(t){const e=Object.assign(Object.assign({event_name:"chrome_label",label:t},this.sender.getTimeBasedParams()),this.sender.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/chromelabels")}};ct=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(rt))],ct);let lt=class{constructor(t,e,n,i){this.window=t,this.geo=e,this.wikiConfig=n,this.sender=i}send(t){const e=Object.assign(Object.assign({},t),this.getTrackingParams());this.sender.sendEvent(e,"https://beacon.wikia-services.com/__track/special/gdpr_events")}getTrackingParams(){var t,e,n,i;return{lang_code:this.getLanguageCode()||"unknown",detected_geo:(this.geo.getCountryCode()||"").toUpperCase(),detected_region:(this.geo.getRegionCode()||"").toUpperCase(),beacon:null===(e=null===(t=this.window.fandomContext)||void 0===t?void 0:t.tracking)||void 0===e?void 0:e.beaconId,pv_unique_id:null===(i=null===(n=this.window.fandomContext)||void 0===n?void 0:n.tracking)||void 0===i?void 0:i.pvUID}}getLanguageCode(){var t,e,n;return this.wikiConfig.get("wgUserLanguage")||(null===(n=null===(e=null===(t=this.window)||void 0===t?void 0:t.navigator)||void 0===e?void 0:e.language)||void 0===n?void 0:n.toLowerCase().substring(0,2))}};function dt(t,e){return Object.keys(e).forEach((function(n){"default"===n||"__esModule"===n||t.hasOwnProperty(n)||Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})})),t}function ut(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}lt=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(l.jf)),(0,t.Qj)(1,(0,e.WQ)(d.u)),(0,t.Qj)(2,(0,e.WQ)(et)),(0,t.Qj)(3,(0,e.WQ)(rt))],lt);var ht={},gt={};function pt(t){return new Promise((e=>setTimeout((()=>e()),t)))}ut(gt,"delay",(()=>pt));var ft={};function vt(){const t=new URLSearchParams(window.location.search.substring(1));return Boolean(t.get("adengine_debug"))?t.get("adengine_debug"):t.get("identity_debug")}ut(ft,"getDebugGroup",(()=>vt));var mt={};ut(mt,"localStorageHelper",(()=>yt));class yt{constructor(t,e=6e4){this.key=t,this.ttlInMilliseconds=e;let n=!1;try{n=void 0!==window.localStorage&&null!==window.localStorage,n&&(window.localStorage.setItem("__test__","test"),window.localStorage.removeItem("__test__"))}catch(t){n=!1}const i=t=>window?.instantConfigCache?.[t]??null,r=(t,e)=>{void 0===window.instantConfigCache&&(window.instantConfigCache={}),window.instantConfigCache[t]=e};this.storageAdapter={getItem:t=>{try{return n?window.localStorage.getItem(t)??i(t):i(t)}catch(e){return i(t)}},setItem:(t,e)=>{try{if(n)return localStorage.setItem(t,e);r(t,e)}catch(n){r(t,e)}}}}set(t){const e=this.getObjectToStore(t);this.storageAdapter.setItem(this.key,JSON.stringify(e))}get(){const t=this.storageAdapter.getItem(this.key);return t?this.parseStoredValue(JSON.parse(t)):null}expired(t){return!t||t<Date.now()}getObjectToStore(t){return{data:t,ttl:Date.now()+this.ttlInMilliseconds}}parseStoredValue(t){return this.expired(t?.ttl)?null:t.data}}var wt={};ut(wt,"lock",(()=>bt)),ut(wt,"release",(()=>kt));const Ct=new yt("instant-config-lock",1e3);function bt(){return"lock"===Ct.get()||(Ct.set("lock"),!1)}function kt(){Ct.set(null)}var St={};ut(St,"getTimeDelta",(()=>jt)),ut(St,"logger",(()=>Et)),ut(St,"warner",(()=>It));const Tt=vt()||"",Qt=Tt.split(","),Ot=Date.now();function jt(){return((Date.now()-(window.performance?.timeOrigin??Ot))/1e3).toFixed(4)}function Et(t,...e){""!==Tt&&("1"!==Tt&&-1===Qt.indexOf(t)||window.console.info(`${jt()}s\t\t ${t}`,e))}function It(t,...e){""!==Tt&&("1"!==Tt&&-1===Qt.indexOf(t)||window.console.warn(t,e))}dt(ht,gt),dt(ht,ft),dt(ht,mt),dt(ht,wt),dt(ht,St);var Rt={},At={};ut(At,"InstantConfigInterpreter",(()=>re));var Mt={},Pt={};function xt(t){return Array.isArray(t)&&t.length>0&&"object"==typeof t[0]}function Dt(t){const e=t.sampling??t.s;return"number"==typeof e&&e>0&&e<100}ut(Pt,"shouldBeListOfConfigGroups",(()=>xt)),ut(Pt,"hasSampling",(()=>Dt));var _t={};ut(_t,"negativePrefix",(()=>Wt)),ut(_t,"cacheSuffix",(()=>Gt)),ut(_t,"samplingSeparator",(()=>Lt)),ut(_t,"worldWide",(()=>Nt)),ut(_t,"precision",(()=>Ut)),ut(_t,"experimentBucketSettingKey",(()=>Vt));const Wt="non-",Gt="-cached",Lt="/",Nt="XX",Ut=10**6,Vt="eb";dt(Mt,Pt),dt(Mt,{}),dt(Mt,{}),dt(Mt,{}),dt(Mt,{}),dt(Mt,{}),dt(Mt,{}),dt(Mt,_t);class Ft{constructor(t,e,n){this.container=e,this.settingsRepository=n,"number"==typeof t?this.experimentBucket=this.manageSampling(t):!0===t?this.experimentBucket=this.manageSampling(0):!1===t&&this.clean()}build(){return()=>this.experimentBucket??Ft.getRandomBucket()}static getRandomBucket(){return Math.floor(100*Math.random())}manageSampling(t){let e=this.readFromLoaderVariable()??this.readFromSettings()??Ft.getRandomBucket();return 100===e&&(e=0),this.storeInLoaderVariable(e),this.storeInSettings(e,t),e}readFromLoaderVariable(){return this.container.fandomContext?.experimentBucket}readFromSettings(){const t=this.settingsRepository&&this.settingsRepository.get(Vt);return t&&Number(t)}storeInSettings(t,e){this.settingsRepository&&this.settingsRepository.set(Vt,t.toString(),e)}storeInLoaderVariable(t){this.container.fandomContext=this.container.fandomContext||{},this.container.fandomContext.experimentBucket=t}clean(){this.settingsRepository&&this.settingsRepository.remove(Vt)}}class Bt{activeKeyValues=[];activeLabradorKeyValues=[];constructor(t){Array.isArray(t)?this.keyValueNamesMap=t.map((t=>t&&t.toString().split(":"))).filter((t=>t&&t.length>=2)).reduce(((t,e)=>(t[e[0]]=e[1],t)),{}):this.keyValueNamesMap={}}getActiveKeyValues(){return this.activeKeyValues}getActiveLabradorKeyValues(){return this.activeLabradorKeyValues}mark(t,e,n){const i=`${t}_${n?"B":"A"}_${n?e:100-e}`,r=this.keyValueNamesMap[i]??i;this.activeKeyValues.includes(i)||this.activeKeyValues.push(i),this.activeLabradorKeyValues.includes(r)||this.activeLabradorKeyValues.push(r)}}var Ht={},$t={};ut($t,"BrowserMatcher",(()=>zt));var qt={};function Kt(t){return t.startsWith(Wt)?{value:t.replace(Wt,""),negated:!0}:{value:t,negated:!1}}ut(qt,"extractNegation",(()=>Kt));class zt{constructor(t){this.currentBrowser=t?.toLowerCase()}isValid(t){const e=t.b??t.browsers??[],n=e.map((t=>t.toLowerCase())).map((t=>Kt(t)));return 0===e.length||!this.currentBrowser||!this.isCurrentNegated(this.currentBrowser,n)&&n.some((t=>this.currentBrowser.includes(t.value)!==t.negated))}isCurrentNegated(t,e){return e.some((e=>t.includes(e.value)&&e.negated))}}var Zt={};ut(Zt,"DeviceMatcher",(()=>Jt));class Jt{constructor(t){this.currentDevice=t}isValid(t){const e=(t.d??t.devices??[]).map((t=>t.toLowerCase())).map((t=>Kt(t)));return 0===e.length||!this.currentDevice||!this.isCurrentNegated(this.currentDevice,e)&&e.some((t=>t.value===this.currentDevice!==t.negated))}isCurrentNegated(t,e){return e.some((e=>t.includes(e.value)&&e.negated))}}var Yt={};ut(Yt,"DomainMatcher",(()=>Xt));class Xt{isValid(t){const e=t.o??t.domains??[];return 0===e.length||e.some((t=>window.location.hostname.includes(t)))}}var te={};ut(te,"RegionMatcher",(()=>ee));class ee{constructor(t){this.geo=t}isValid(t,e){const n=t.r??t.regions??[],i=this.filterOutInvalidRegions(n);return e?e(i):this.isProperGeo(i)}getCountryCode(){return this.geo?.country}getRegionCode(){return this.geo?.region}getContinentCode(){return this.geo?.continent}isProperGeo(t=[]){return!(!t||!t.indexOf||this.isGeoExcluded(t)||!(this.isProperContinent(t)||this.isProperCountry(t)||this.isProperRegion(t)))}filterOutInvalidRegions(t){return t.filter((t=>!t.includes(Lt))).filter((t=>!t.includes(Gt)))}isProperCountry(t){return!!(t&&t.indexOf&&(t.indexOf(this.getCountryCode())>-1||this.isSampledForGeo(t,this.getCountryCode())))}isProperRegion(t){const e=`${this.getCountryCode()}-${this.getRegionCode()}`;return!!(t&&t.indexOf&&(t.indexOf(e)>-1||this.isSampledForGeo(t,e)))}containsContinent(t){const e=`${Nt}-${this.getContinentCode()}`;return t.indexOf(e)>-1||this.isSampledForGeo(t,e)}containsWorldWide(t){return t.indexOf(Nt)>-1||this.isSampledForGeo(t,Nt)}isProperContinent(t){return!(!t||!t.indexOf||!this.containsWorldWide(t)&&!this.containsContinent(t))}isGeoExcluded(t){return!!(t.indexOf(`${Wt}${this.getCountryCode()}`)>-1||t.indexOf(`${Wt}${this.getCountryCode()}-${this.getRegionCode()}`)>-1||t.indexOf(`${Wt}${Nt}-${this.getContinentCode()}`)>-1)}hasSampling(t){return e=>0!==e.indexOf(Wt)&&e.indexOf(t+Lt)>-1}getSamplingLimits(t){let[,e]=t.split(Lt);return e=e.replace(Gt,""),Math.round(parseFloat(e)*Ut)||0}isSampledForGeo(t,e){const n=t.filter(this.hasSampling(e));if(0===n.length)return!1;const i=Math.round(Math.random()*(100*Ut))||0;return n.map((t=>this.getSamplingLimits(t))).some((t=>i<t))}}var ne={};ut(ne,"SamplingMatcher",(()=>ie));class ie{constructor(t){this.samplingProvider=t,this.precision=10**6}isValid(t){return Math.round(this.samplingProvider()*this.precision)<Math.round(t*this.precision)}}dt(Ht,$t),dt(Ht,Zt),dt(Ht,Yt),dt(Ht,qt),dt(Ht,te),dt(Ht,ne);class re{constructor(t=new zt,e=new Jt,n=new Xt,i=new ee,r){this.browserMatcher=t,this.deviceMatcher=e,this.domainMatcher=n,this.regionMatcher=i,this.settingsRepository=r,this.logGroup="instant-config-interpreter",this.configResponse={}}init(t,e={},n,i=window){return this.configResponse={...e,...t},this.regionValidationPredicate=n,this.labradorKeyValuesMapper=new Bt(this.getValue("icLABradorGamKeyValues")),this.samplingMatcher=new ie(new Ft(this.getValue("icExperimentBucket"),i,this.settingsRepository).build()),this}getValues(){return ht.logger(this.logGroup,"get values called with",this.configResponse),void 0===this.values&&(this.values=Object.keys(this.configResponse).reduce(((t,e)=>(t[e]=this.getValue(e),t)),{})),this.values}getValue(t){const e=this.configResponse[t];if(xt(e)){const n=e.find(this.predicate(t));return n?.v??n?.value}return e}getActiveKeyValues(){return this.labradorKeyValuesMapper.getActiveKeyValues()}getActiveLabradorKeyValues(){return this.labradorKeyValuesMapper.getActiveLabradorKeyValues()}predicate(t){return e=>{const n=this.browserMatcher.isValid(e)&&this.deviceMatcher.isValid(e)&&this.domainMatcher.isValid(e)&&this.regionMatcher.isValid(e,this.regionValidationPredicate);if(!Dt(e)||!1===n)return n;const i=e?.s??e?.sampling,r=this.samplingMatcher.isValid(i);return this.labradorKeyValuesMapper.mark(t,i,r),r}}}var oe={};async function se(t,e=2e3){const n=new AbortController,i=setTimeout((()=>n.abort()),e),r=await fetch(t,{signal:n.signal});return clearTimeout(i),r}ut(oe,"InstantConfigLoader",(()=>ce));const ae="instant-config-loader";class ce{constructor(t,e=window){this.params=t,this.container=e,this.storage=new ht.localStorageHelper(`instant-config-${t.appName}`,6e4),this.container.icbm=this.container.icbm||{},this.instantConfig=this.container.instantConfig,this.lockDelay="number"==typeof t.lockDelay?t.lockDelay:500}async getConfig(){if(this.instantConfig)return this.instantConfig;let t;return this.lockDelay>0?t=this.fetchInstantConfigThroughCache():(this.container.icbm.fetch||(this.container.icbm.fetch=this.fetchInstantConfig()),t=this.container.icbm.fetch),t.then((t=>t??this.fetchFallbackConfig()))}async fetchInstantConfigThroughCache(t=!1){if(ht.lock()&&!t)return ht.logger(ae,"locked, awaiting",this.lockDelay),await pt(this.lockDelay),this.fetchInstantConfigThroughCache(!0);try{const t=this.storage.get();if(t)return ht.logger(ae,"instant config pulled from local storage",t),JSON.parse(t);const e=await this.fetchInstantConfig();return e&&this.storage.set(JSON.stringify(e)),ht.release(),e}catch(t){ht.warner(ae,"could not get instant config via cache",t),ht.release()}}async fetchInstantConfig(){const t=this.params.instantConfigEndpoint??"https://services.fandom.com",e=this.params.instantConfigVariant??"icbm",{appName:n,compact:i}=this.params,r=new URLSearchParams({app:n});i&&r.set("compact","true");const o=`${t}/${e}/api/config?${r.toString()}`;try{const t=await se(o,this.params.requestTimeout);if(!t.ok)return;const e=await t.json();return ht.logger(ae,"instant config fetched",e),e}catch(t){return void ht.warner(ae,"could not fetch instant config",t)}}async fetchFallbackConfig(){ht.logger(ae,"Fetching fallback config");const t=this.params.instantConfigFallbackEndpoint;if(void 0===t)return{};try{ht.logger(ae,t);const e=await se(t,this.params.requestTimeout);if(!e.ok)return{};const n=await e.json();return ht.logger(ae,"fallback config fetched",n),n}catch(t){return ht.warner(ae,"could not fetch fallback config",t),{}}}}var le={};ut(le,"InstantConfigOverrider",(()=>ue));const de=["InstantGlobals","icbm"];class ue{override(t,e){return[...t.keys()].filter((t=>{return e=t,de.some((t=>e.startsWith(`${t}.`)||e.startsWith(`${t}__`)));var e})).map((t=>{const[,e]=t.split(".").map((t=>t.split("__"))).flat();return{paramKey:t,key:e}})).map((({paramKey:e,key:n})=>({key:n,value:this.parseValue(t.get(e))}))).reduce(((t,{key:e,value:n})=>({...t,[e]:n})),e)}parseValue(t){if("true"===t||"false"===t)return"true"===t;const e=parseInt(t,10);if(t===`${e}`)return e;try{return JSON.parse(t)}catch(e){return t||null}}}dt(Rt,At),dt(Rt,oe),dt(Rt,le),dt(Rt,Ht);class he{constructor(t,e,n){this.cookiesManager=t,this.communicationService=e,this.topLevelDomain=J.extract(n.location.hostname)}get(t){return this.cookiesManager.get(t)}remove(t){this.cookiesManager.remove(t,{domain:this.topLevelDomain})}set(t,e,n){this.communicationService.on(S,(i=>{if((!i.geoRequiresSignal||!i.ccpaSignal)&&(!i.geoRequiresConsent||i.gdprConsent)){const i={domain:this.topLevelDomain};n&&(i.expires=n),this.cookiesManager.set(t,e,i)}}))}}let ge=class{constructor(t,e,n,i,r,o,s,a,c){this.adsContext=t,this.device=e,this.browser=n,this.platform=i,this.geo=r,this.serviceBaseUrl=o,this.window=s,this.cookiesManager=a,this.logger=c,this.repository={},this.isLoadedByOdyssey=C(this.window)}init(e){return(0,t.sH)(this,arguments,void 0,(function*(e,n={}){var i;if(this.isLoadedByOdyssey)return this.repository=yield this.loadConfigFromOdyssey(),this.logger.info("instantiated with",this.repository),this;const r=null===(i=this.adsContext.get())||void 0===i?void 0:i.env,o=this.serviceBaseUrl.get().slice(0,-1),s=this.platform.get(),a=this.geo.get();return this.repository=yield function(e,n,i,r,o,s,a,c){return(0,t.sH)(this,arguments,void 0,(function*(t,e,n,i,r,o,s,a,c={},l){const d=new ce({appName:i,instantConfigEndpoint:a,instantConfigFallbackEndpoint:`https://script.wikia.nocookie.net/fandom-ae-assets/icbm/${null!=l?l:"prod"}/icbm_state_${i}.json`,compact:!0}),u=new he(e,t,n),h=new re(new zt(r),new Jt(o),new Xt,new ee(s),u);let g=yield d.getConfig();return g=(new ue).override(z.C.getURLSearchParams(),g),h.init(g,c).getValues()}))}(e,this.cookiesManager,this.window,s,this.browser.getBrowser(),this.device.getDeviceType(),a,o,n,r),this.logger.info("instantiated with",this.repository),this}))}get(t,e){var n,i;return null!==(i=null===(n=this.repository)||void 0===n?void 0:n[t])&&void 0!==i?i:e}loadConfigFromOdyssey(){var t;return(null===(t=this.window.icbm)||void 0===t?void 0:t.config)?Promise.resolve(this.window.icbm.config):new Promise((t=>{this.window.addEventListener("instantConfigLoaded",(()=>{t(this.window.icbm.config)}))}))}};ge=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(u)),(0,t.Qj)(1,(0,e.WQ)(y)),(0,t.Qj)(2,(0,e.WQ)(m)),(0,t.Qj)(3,(0,e.WQ)(v)),(0,t.Qj)(4,(0,e.WQ)(d.u)),(0,t.Qj)(5,(0,e.WQ)(h)),(0,t.Qj)(6,(0,e.WQ)(l.jf)),(0,t.Qj)(7,(0,e.WQ)(l.AZ)),(0,t.Qj)(8,(0,e.MR)(s.V,s.O,"InstantConfig"))],ge);var pe=r(978);let fe=class{constructor(t){this.instantConfigService=t,this.cachedValues=new Map}isLimitedTraffic(t){if((0,pe.A)())return!1;if(this.cachedValues.has(t))return this.cachedValues.get(t);const e=this.instantConfigService.get("dwIdentityTrafficLimits",{}),n=this.getEventName(t);if(void 0===(null==e?void 0:e[n])||100===e[n])return!1;const i=e[n]<100*Math.random();return this.cachedValues.set(t,i),i}getEventName(t){var e;return null!==(e=st[t])&&void 0!==e?e:"undefined"}};fe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)((0,e.cb)((()=>ge))))],fe);let ve=class{constructor(t,e,n,i,r,o){this.logger=t,this.identityEventSender=e,this.loadTimeEventSender=n,this.chromeLabelSender=i,this.consentEventSender=r,this.dataWarehouseTrafficLimiter=o}track(t,e){if(!this.dataWarehouseTrafficLimiter.isLimitedTraffic(t))switch(t){case st.identity:this.identityEventSender.send(e);break;case st.loadTime:this.loadTimeEventSender.send(e);break;case st.chromeLabel:this.chromeLabelSender.send(e);break;case st.consents:this.consentEventSender.send(e);break;default:this.logger.info("Invalid event type to track")}}};ve=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"DataWarehouseService")),(0,t.Qj)(1,(0,e.WQ)(ot)),(0,t.Qj)(2,(0,e.WQ)(at)),(0,t.Qj)(3,(0,e.WQ)(ct)),(0,t.Qj)(4,(0,e.WQ)(lt)),(0,t.Qj)(5,(0,e.WQ)(fe))],ve);class me{constructor(t,e,n){this.logger=t,this.dataWarehouse=e,this.geo=n,this.eventQueue=[],this.sendImmediately=!1,this.gpcRegistered=!1}init(){this.logger.info(`Starting ${this.cmpName} tracker`),this.UI_SHOWN=`${this.cmpName}-ui-shown`,this.geo.isGdprCountry()?this.GA_CATEGORY=`gdpr-modal-${this.cmpName}`:"us"===this.geo.getCountryCode()?this.GA_CATEGORY=`ccpa-modal-${this.cmpName}`:this.logger.info(`Not a GDPR or CCPA country, skipping ${this.cmpName} tracker`,this.geo.getCountryCode())}ready(){this.sendImmediately||(this.sendImmediately=!0,this.sendQueuedEvents())}sendActionEvent(t){this.logger.info("Queued sending action event"),this.sendEvent(t)}sendImpressionEvent(t="modal-view"){this.logger.info("Queued sending impression event"),this.sendEvent(t,"impression"),this.trackLoadTime()}trackLoadTime(){this.dataWarehouse.track(st.loadTime,this.UI_SHOWN),this.logger.info("Loading time tracking event sent")}sendEvent(t,e="click"){this.eventQueue.find((n=>n.label===t&&n.action===e))||this.eventQueue.push({label:t,action:e}),this.sendImmediately&&this.sendQueuedEvents()}sendQueuedEvents(){for(;this.eventQueue.length>0;){const t=this.eventQueue.shift(),e={ga_category:this.GA_CATEGORY,ga_action:t.action,ga_label:t.label};this.dataWarehouse.track(st.consents,e),this.logger.info("Action tracking event sent",t.label)}}}let ye=class extends me{constructor(t,e,n){super(t,e,n),this.logger=t,this.dataWarehouse=e,this.geo=n,this.cmpName="1t"}sendGPCEvent(){this.gpcRegistered?this.logger.info("GPC event already sent"):(this.gpcRegistered=!0,this.logger.info("Queued sending GPC event"),this.sendEvent("gpc","impression"))}};var we;ye=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"OneTrustTracker")),(0,t.Qj)(1,(0,e.WQ)(ve)),(0,t.Qj)(2,(0,e.WQ)(d.u))],ye),function(t){t.yes="Y",t.no="N",t.na="-"}(we||(we={}));let Ce=class{constructor(t,e){this.window=t,this.cookiesManager=e,this.usPrivacyCookie="usprivacy",this.USP_API_VERSION=1,this.explicitNotice=we.yes,this.lspaSupport=we.no}createPrivacyCookie(t=we.na){const e=J.extract(this.window.location.hostname),n=t===we.na?`${this.USP_API_VERSION}${we.na}${we.na}${we.na}`:`${this.USP_API_VERSION}${this.explicitNotice}${t}${this.lspaSupport}`;this.cookiesManager.set(this.usPrivacyCookie,n,{domain:e,sameSite:"Lax",expires:365})}getPrivacyString(){return this.cookiesManager.get(this.usPrivacyCookie)}};Ce=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf)),(0,t.Qj)(1,(0,e.WQ)(l.AZ))],Ce);const be={".fanatical.com":"0ab0e172-dc9c-44b9-8a58-c80d9ba4fae0",".futhead.com":"82c642a4-d3a9-4a78-a310-21a7b49ab17b",".gamespot.com":"73588546-b116-4dbc-ab64-9db97e11fc0d",".metacritic.com":"50e16f1d-a929-4cc0-80a7-3c5c303eea6a",".muthead.com":"fb34a16e-696d-4748-af9f-96f3b9e2b4da",".tvguide.com":"ffc22311-f4da-4e03-a1ad-32aecd522c5b",".fandom.com":"dea70a1b-c82d-4fe0-86ff-5e164b0a6022",".fandom-dev.pl":"0195d37b-9d1b-7a59-ae6e-31a365aca256",".fandom-dev.us":"0195d387-ba18-754d-9ad7-8673011966c3"},ke={C0001:"necessary",C0002:"performance",C0003:"functional",C0004:"targeting",C0005:"social"};let Se=class{constructor(t,e,n,i,r,o,s,a,c){this.cookiesManager=t,this.window=e,this.navigator=n,this.assetLoader=i,this.geo=r,this.usPrivacy=o,this.logger=s,this.oneTrustTracker=a,this.communicationService=c,this.trackingGroup="C0004:1",this.testMode=!!z.C.get("ot_test"),this.enableDelayedActionEvent=!1,this.initialized=!1,this.UI_READINESS_AWAIT_TIME=100,this.UI_READINESS_TRIES=100,this.loadCCPAAddon(),this.oneTrustTracker.init(),this.oneTrustScriptLoaded()||this.loadOneTrustScripts(),this.waitForOneTrustSDK().then((()=>{this.initializeListeners()})).catch((t=>{b(t)})),this.addChangeListener()}getConsentApi(){return"us"===this.geo.getCountryCode()?"usp":this.geo.isGdprCountry()?"tcf":void 0}getConsentString(){return"tcf"===this.getConsentApi()?this.cookiesManager.get("eupubconsent-v2"):"usp"===this.getConsentApi()?this.usPrivacy.getPrivacyString():void 0}getCategories(){var t;const e=this.getOneTrustConsentCookie(),n=null!==(t=new URLSearchParams(e).get("groups"))&&void 0!==t?t:"";return Object.entries(ke).reduce(((t,[e,i])=>(n.includes(`${e}:1`)&&(t[i]=!0),t)),{necessary:!1,performance:!1,functional:!1,targeting:!1,social:!1})}subscribe(t){!this.oneTrustModalClosed()&&this.geo.isGdprCountry()||(this.consentsUpdated(t),this.oneTrustTracker.ready()),this.initialize(t)}oneTrustScriptLoaded(){return null!==document.querySelector("script[data-domain-script]")}oneTrustModalClosed(){const t=this.cookiesManager.get("OptanonAlertBoxClosed");return Boolean(t)}initialize(t){this.logger.info("Initializing OneTrust");const e=this.window.OptanonWrapper;this.window.OptanonWrapper=()=>{this.logger.info("OneTrust Wrapper Called");const n=this.oneTrustModalClosed(),i=this.geo.isGdprCountry()||"us"===this.geo.getCountryCode();if(n||!i)return this.consentsUpdated(t),this.oneTrustTracker.ready(),null==e?void 0:e()}}getOneTrustConsentCookie(){const t=this.cookiesManager.get("OptanonConsent"),e=new URLSearchParams(t),n={};return e.forEach(((t,e)=>{n[e]=t})),this.logger.info("OneTrust cookie",n),n}oneTrustCookieExists(){return!!this.getOneTrustConsentCookie()}readTrackingConsents(){var t,e;const n=this.getOneTrustConsentCookie(),i=(null===(e=null===(t=n.groups)||void 0===t?void 0:t.split("groups=").pop())||void 0===e?void 0:e.split(";")[0])||"";return i.length&&n.groups?i.includes(this.trackingGroup):"us"===this.geo.getCountryCode()&&!this.navigator.globalPrivacyControl}consentsUpdated(t){if(this.geo.isGdprCountry()&&!this.oneTrustCookieExists())return void this.logger.info("OneTrust cookie not found");const e=this.geo.getCountryCode(),n=this.readTrackingConsents();if(this.initialized=!0,e){if("us"===e){if(this.navigator.globalPrivacyControl)return this.logger.info("OneTrust GPC registered"),this.oneTrustTracker.sendGPCEvent(),this.usPrivacy.createPrivacyCookie(we.yes),this.handleDelayedEvent(!1),void t({gdprConsent:!0,geoRequiresConsent:!1,geoRequiresSignal:!0,ccpaSignal:!0});this.usPrivacy.createPrivacyCookie(n?we.no:we.yes)}this.handleDelayedEvent(n),t({gdprConsent:!Z.e.includes(e)||n,geoRequiresConsent:Z.e.includes(e),geoRequiresSignal:"us"===e,ccpaSignal:"us"===e&&!n})}}loadOneTrustScripts(){return(0,t.sH)(this,void 0,void 0,(function*(){var t;this.logger.info("Loading OneTrust scripts"),yield this.assetLoader.loadScript("https://cdn.cookielaw.org/scripttemplates/otSDKStub.js","text/javascript",!0,null,{"data-domain-script":this.getDomainId()}),Z.e.includes(null!==(t=this.geo.getCountryCode())&&void 0!==t?t:"")&&void 0===this.window.__tcfapi&&(this.logger.info("Loading OneTrust TCF"),yield this.assetLoader.loadScript("https://cdn.cookielaw.org/consent/tcf.stub.js","text/javascript",!0,null,{charSet:"UTF-8","data-domain-script":this.getDomainId()}))}))}getDomainId(){var t;const e=J.extract(this.window.location.hostname),n=null!==(t=be[e])&&void 0!==t?t:be[".fandom.com"];return this.testMode?`${n}-test`:n}loadCCPAAddon(){return"us"!==this.geo.getCountryCode()||!0===this.window.fandomCmp.ready&&"usp"===this.window.fandomCmp.consentApi?Promise.resolve():this.assetLoader.loadScript("https://cdn.cookielaw.org/opt-out/otCCPAiab.js","text/javascript",!0,null,{charSet:"UTF-8","ccpa-opt-out-geo":"us","ccpa-opt-out-ids":"C0004","ccpa-opt-out-lspa":"false","data-domain-script":this.getDomainId()})}addChangeListener(){this.communicationService.on(R,(({optOut:t})=>{this.setConsent(t)}))}setConsent(e){return(0,t.sH)(this,void 0,void 0,(function*(){const t=e?"0":"1";this.logger.info("Setting OneTrust consent",t),yield(0,Y.f)((()=>{var t;return!!(null===(t=this.window.OneTrust)||void 0===t?void 0:t.UpdateConsent)}),50),this.window.OneTrust.UpdateConsent("Category",`C0001:1,C0002:1,C0004:${t},C0003:1,C0005:1`)}))}initializeListeners(){return(0,t.sH)(this,void 0,void 0,(function*(){this.logger.info("Initializing listeners"),this.addClickListener(),this.addImpressionListener()}))}waitForOneTrustSDK(){return(0,t.sH)(this,void 0,void 0,(function*(){let t=0;try{yield(0,Y.f)((()=>(t++,this.logger.info(`Waiting for SDK (${t})`),!!document.querySelector("#onetrust-consent-sdk"))),this.UI_READINESS_TRIES,this.UI_READINESS_AWAIT_TIME,10)}catch(t){throw new Error("OneTrust SDK was not initialized")}}))}addClickListener(){var t;null===(t=document.querySelector("#onetrust-consent-sdk"))||void 0===t||t.addEventListener("click",(t=>{switch(t.target.id){case"onetrust-accept-btn-handler":case"accept-recommended-btn-handler":return this.oneTrustTracker.sendActionEvent("accept");case"onetrust-reject-btn-handler":case"onetrust-reject-all-handler":return this.oneTrustTracker.sendActionEvent("reject");default:{const e=t.target.classList;if(e.contains("ot-pc-refuse-all-handler"))return this.oneTrustTracker.sendActionEvent("reject");if(e.contains("onetrust-close-btn-ui"))return this.oneTrustTracker.sendActionEvent("close");e.contains("save-preference-btn-handler")&&(this.initialized?(this.logger.info("OneTrust modal action is being sent"),setTimeout((()=>{this.oneTrustTracker.sendActionEvent(this.readTrackingConsents()?"accept":"reject")}))):(this.logger.info("OneTrust modal is not visible"),this.enableDelayedActionEvent=!0))}}}))}addImpressionListener(){var t;const e={attributes:!1,childList:!1,characterData:!0};null===(t=document.querySelector(".ot-sdk-show-settings"))||void 0===t||t.addEventListener("click",(()=>{this.oneTrustTracker.sendImpressionEvent()}));const n=document.getElementById("onetrust-consent-sdk");document.getElementById("onetrust-banner-sdk")&&this.oneTrustTracker.sendImpressionEvent(),n&&new MutationObserver((t=>{this.logger.info("Checking if modal is shown ",t),document.querySelector(".ot-sdk-container")?(this.logger.info("OneTrust modal is visible"),this.oneTrustTracker.sendImpressionEvent()):this.logger.info("OneTrust modal is not visible")})).observe(n,e)}handleDelayedEvent(t){this.logger.info("Handling delayed action event ",t),this.enableDelayedActionEvent&&(this.enableDelayedActionEvent=!1,this.oneTrustTracker.sendActionEvent(t?"accept":"reject"))}};Se=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.AZ)),(0,t.Qj)(1,(0,e.WQ)(l.jf)),(0,t.Qj)(2,(0,e.WQ)(l.kW)),(0,t.Qj)(3,(0,e.WQ)(X)),(0,t.Qj)(4,(0,e.WQ)(d.u)),(0,t.Qj)(5,(0,e.WQ)(Ce)),(0,t.Qj)(6,(0,e.MR)(s.V,s.O,"OneTrust")),(0,t.Qj)(7,(0,e.WQ)(ye)),(0,t.Qj)(8,(0,e.WQ)(K))],Se);let Te=class{constructor(t,e){this.logger=t,this.oneTrust=e}subscribe(t){this.logger.info("OneTrust installed"),this.oneTrust.subscribe(t)}getConsentApi(){return this.oneTrust.getConsentApi()}getConsentString(){return this.oneTrust.getConsentString()}};var Qe;Te=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"OptInService")),(0,t.Qj)(1,(0,e.WQ)(Se))],Te),function(t){t.COOKIEBOT="cookiebot",t.ONETRUST="onetrust"}(Qe||(Qe={}));let Oe=class{get(n){return(0,t.sH)(this,void 0,void 0,(function*(){if(n===Qe.ONETRUST)return e.kL.resolve(Te);if(n===Qe.COOKIEBOT){const{FanaticalConsentStrategy:t}=yield r.e(482).then(r.bind(r,341));return e.kL.resolve(t)}const{StaticConsentStrategy:t}=yield r.e(319).then(r.bind(r,322));return e.kL.resolve(t)}))}};var je;Oe=(0,t.Cg)([(0,e.Gr)()],Oe),function(t){t.tracking="tracking",t.page="page",t.site="site",t.partners="partners",t.targeting="targeting"}(je||(je={}));let Ee=class{constructor(t){this.window=t}get(t,e){if(this.window.fandomContext&&this.window.fandomContext[t])return this.window.fandomContext[t][e]}set(t,e,n){this.window.fandomContext&&this.window.fandomContext[t]?this.window.fandomContext[t][e]=n:this.window.fandomContext=Object.assign(Object.assign({page:{},site:{}},this.window.fandomContext),{[t]:{[e]:n}})}remove(t,e){if(this.window.fandomContext&&this.window.fandomContext[t])try{delete this.window.fandomContext[t][e]}catch(t){}}};function Ie(t){return"1"!==t}Ee=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(l.jf))],Ee);const Re="ag";let Ae=class{constructor(t,e,n,i,r,o,s,a){this.cookiesManager=t,this.window=e,this.wikiConfig=n,this.context=i,this.logger=r,this.geo=o,this.communicationService=s,this.contextRepository=a,this.ageGateExpiryMs=31536e6}applies(t){if(!this.isEnabled()||t)return this.logger.info("disabled"),!1;const e=void 0===this.cookiesManager.get(Re);return this.logger.info("applies",e),e}resolveCoppaStatus(t){if(!this.isEnabled())return this.setIsCoppaSubjectInContext(!1),!1;if(t)return this.setIsCoppaSubjectInContext(!0),!0;const e=Ie(this.cookiesManager.get(Re));return this.setIsCoppaSubjectInContext(e),e}isEnabled(){var t,e;const n=Boolean(null===(e=null===(t=this.context.get())||void 0===t?void 0:t.targeting)||void 0===e?void 0:e.directedAtChildren);return Boolean(n&&this.wikiConfig.get("wgAgeGateEnabled",!1))}waitForAgeGateDataAndSetCookie(){return(0,t.sH)(this,void 0,void 0,(function*(){return new Promise((t=>{const e=this.cookiesManager.get(Re);if(void 0===e)this.communicationService.on(E,(({payload:e})=>{this.setAgeGateCookie(e);const n=!e.adult;"us"===this.geo.getCountryCode()&&n&&this.updateConsentCookie(n),t(this.updateConsents(n))}));else{this.logger.info("Age gate cookie already set");const n=Ie(e);t(this.updateConsents(n))}}))}))}setAgeGateCookie(t){var e,n;t||this.logger.warn("Payload data missing, using defaults");const i=null!==(e=null==t?void 0:t.adult)&&void 0!==e&&e,r=null!==(n=null==t?void 0:t.timestamp)&&void 0!==n?n:Date.now();this.cookiesManager.set(Re,i?"1":"0",{domain:this.getTopLevelDomain(),expires:new Date(r+this.ageGateExpiryMs)})}updateConsentCookie(t){this.communicationService.emit(new k(R,{optOut:t}))}getTopLevelDomain(){const t=this.window.location.hostname;return J.extract(t)}updateConsents(t){return{ccpaSignal:t,geoRequiresSignal:"us"===this.geo.getCountryCode(),gdprConsent:!t,geoRequiresConsent:this.geo.isGdprCountry()}}setIsCoppaSubjectInContext(t){this.contextRepository.set(je.partners,"directedAtChildren",t),this.contextRepository.set(je.partners,"blockthrough",{directedAtChildren:t})}};Ae=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.AZ)),(0,t.Qj)(1,(0,e.WQ)(l.jf)),(0,t.Qj)(2,(0,e.WQ)(et)),(0,t.Qj)(3,(0,e.WQ)(u)),(0,t.Qj)(4,(0,e.MR)(s.V,s.O,"AgeGate")),(0,t.Qj)(5,(0,e.WQ)(d.u)),(0,t.Qj)(6,(0,e.WQ)(K)),(0,t.Qj)(7,(0,e.WQ)(Ee))],Ae);const Me=t=>t.geoRequiresSignal?!t.ccpaSignal:!t.geoRequiresConsent||t.gdprConsent;let Pe=class{constructor(t,e,n,i,r){this.communicationService=t,this.logger=e,this.consentProviderFactory=n,this.ageGateHandler=i,this.window=r,this.consentProvider=null,this.consentUpdated=!1}init(e){const n=e.get("icPreferredCMP");this.consentProviderFactory.get(n).then((e=>{this.consentProvider=e,this.consentProvider.subscribe((e=>(0,t.sH)(this,void 0,void 0,(function*(){if(this.handleConsents(e),this.ageGateHandler.applies(!Me(e))){const t=yield this.ageGateHandler.waitForAgeGateDataAndSetCookie();this.handleConsents(t)}}))))}))}onReady(){const t=()=>void 0!==this.window.fandomCmp&&this.window.fandomCmp.ready&&!this.window.fandomCmp.blocking;return t()?Promise.resolve():new Promise((e=>{const n=()=>{t()&&(e(),this.window.removeEventListener("fandomConsentUpdate",n))};this.window.addEventListener("fandomConsentUpdate",n)}))}handleConsents(t){this.logger.info("Sending consents: ",t,"update?",this.consentUpdated),this.consentUpdated&&this.sendConsentsUpdateToAdEngine(t),this.sendConsentsToAdEngine(t),this.consentUpdated||(this.consentUpdated=!0)}sendConsentsToAdEngine(t){this.sendFandomCmpEvent("fandomConsentUpdate",t),this.communicationService.emit(new k(S,t))}sendConsentsUpdateToAdEngine(t){this.sendFandomCmpEvent("fandomConsentUpdate",t),this.communicationService.emit(new k(T,t))}sendFandomCmpEvent(t,e){var n,i,r,o,s,a;const c=!Me(e),l={ready:!0,blocking:this.ageGateHandler.applies(c),coppa:this.ageGateHandler.resolveCoppaStatus(c),optOut:c,consentApi:null===(i=null===(n=this.consentProvider)||void 0===n?void 0:n.getConsentApi)||void 0===i?void 0:i.call(n),consentString:null===(o=null===(r=this.consentProvider)||void 0===r?void 0:r.getConsentString)||void 0===o?void 0:o.call(r),consents:null===(a=null===(s=this.consentProvider)||void 0===s?void 0:s.getConsents)||void 0===a?void 0:a.call(s)};this.window.fandomCmp=l,this.window.dispatchEvent(new CustomEvent(t,{detail:l}))}};Pe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(K)),(0,t.Qj)(1,(0,e.MR)(s.V,s.O,"OptInService")),(0,t.Qj)(2,(0,e.WQ)(Oe)),(0,t.Qj)(3,(0,e.WQ)(Ae)),(0,t.Qj)(4,(0,e.WQ)(l.jf))],Pe);let xe=class{constructor(t,e,n){this.dataWarehouse=t,this.window=e,this.logger=n}activateTracking(){if(!this.isEnabled())return void this.logger.info("Hem Tracking is disabled");const t=this.extractHEMs();Object.keys(t).forEach((e=>{t[e]&&this.dataWarehouse.track(st.identity,{partner_name:"MediaWiki-"+e,partner_identity_id:t[e]})}))}isEnabled(){var t,e,n;return(null===(n=null===(e=null===(t=this.window.ads)||void 0===t?void 0:t.context)||void 0===e?void 0:e.opts)||void 0===n?void 0:n.userEmailHashes)&&this.window.ads.context.opts.userEmailHashes.length>0}extractHEMs(){const[t,e,n]=this.window.ads.context.opts.userEmailHashes;return{md5:t,sha1:e,sha256:n}}};function De(t){const e=new Date,n=Math.floor(t>=0?t:0);return e.setMinutes(e.getMinutes()+n),e}xe=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(ve)),(0,t.Qj)(1,(0,e.WQ)(l.jf)),(0,t.Qj)(2,(0,e.MR)(s.V,s.O,"HemTracking"))],xe);let _e=class{generate(){let t="";for(;t.length<10;)t+="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_-"[64*Math.random()|0];return t}generateV2(){return`${this.generate()}.${Date.now()}`}};_e=(0,t.Cg)([(0,e._G)()],_e);let We=class{constructor(t){this.cookiesManager=t}getNextNumberFromCookie(t){const e=parseInt(this.cookiesManager.get(t));return Number.isNaN(e)?1:e+1}};We=(0,t.Cg)([(0,e._G)(),(0,t.Qj)(0,(0,e.WQ)(l.AZ))],We);let Ge=class{constructor(t,e,n,i,r,o,s,a){this.contextRepository=t,this.cookiesManager=e,this.uuid=n,this.beaconGenerator=i,this.pageViewNumberGenerator=r,this.window=o,this.wikiConfig=s,this.communicationService=a,this.communicationService.on(I,(()=>{this.updatePageViewData()}))}set(t,e,n){this.contextRepository.set(je.tracking,t,e),this.cookiesManager.set(t,e.toString(),n)}remove(t){this.contextRepository.remove(je.tracking,t),this.cookiesManager.remove(t)}updatePageViewData(){const t=this.window.location.hostname,e=J.extract(t);this.contextRepository.set(je.tracking,"pvUID",this.wikiConfig.get("pvUID")||this.window.pvUID||this.uuid()),this.set("pvNumber",this.pageViewNumberGenerator.getNextNumberFromCookie("pvNumber"),{domain:t,expires:De(30)}),this.set("pvNumberGlobal",this.pageViewNumberGenerator.getNextNumberFromCookie("pvNumberGlobal"),{domain:e,expires:De(30)})}updateUserTrackingData(){const t=this.window.location.hostname,e=J.extract(t),n=this.cookiesManager.get("wikia_beacon_id")||this.cookiesManager.get("beaconId")||this.beaconGenerator.generate();this.contextRepository.set(je.tracking,"beaconId",n),this.cookiesManager.set("wikia_beacon_id",n,{domain:e,expires:180});const i=this.cookiesManager.get("_b2");this.cookiesManager.set("_b2",i||this.beaconGenerator.generateV2(),{domain:e,expires:730});const r=this.wikiConfig.get("sessionId",this.window.sessionId)||this.cookiesManager.get("sessionId"),o={domain:e,expires:De(30)};this.set("sessionId",r||this.uuid(),o);const s=this.cookiesManager.get("wikia_session_id");this.cookiesManager.set("wikia_session_id",s||this.beaconGenerator.generate(),{domain:e,expires:180})}setup(){this.updateUserTrackingData(),this.updatePageViewData(),this.communicationService.emit(new k(Q));const t=new CustomEvent("fandomContextUpdate");this.window.dispatchEvent(t)}clear(){this.remove("beaconId"),this.remove("sessionId"),this.remove("pvNumber"),this.remove("pvNumberGlobal")}};var Le;Ge=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(Ee)),(0,t.Qj)(1,(0,e.WQ)(l.AZ)),(0,t.Qj)(2,(0,e.WQ)(l.kk)),(0,t.Qj)(3,(0,e.WQ)(_e)),(0,t.Qj)(4,(0,e.WQ)(We)),(0,t.Qj)(5,(0,e.WQ)(l.jf)),(0,t.Qj)(6,(0,e.WQ)(et)),(0,t.Qj)(7,(0,e.WQ)(K))],Ge),function(t){t.LOCAL="local",t.IDENTITY_STORAGE="identity_storage"}(Le||(Le={}));class Ne{constructor(t){this.storage=t}getItem(t){const e=this.storage.getItem(t);try{return null!==e?JSON.parse(e):null}catch(t){return e}}setItem(t,e){const n=e instanceof Object?JSON.stringify(e):e;this.storage.setItem(t,n)}removeItem(t){return this.storage.removeItem(t)}}let Ue=class{constructor(t){this.storageAdapter=new Ne(t.localStorage)}getItem(t){return this.storageAdapter.getItem(t)}setItem(t,e){try{this.storageAdapter.setItem(t,e)}catch(t){}}removeItem(t){return this.storageAdapter.removeItem(t)}};Ue=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf))],Ue);let Ve=class{constructor(t,e,n,i,r){this.logger=t,this.uuid=e,this.storage=n,this.serviceBaseUrl=i,this.httpClient=r,this.IdentityStorageKey="identity",this.identityServiceUrl=this.serviceBaseUrl.get()+"identity-storage/"}fetchData(){return(0,t.sH)(this,void 0,void 0,(function*(){try{const t=yield this.httpClient.get(this.identityServiceUrl,{mode:"cors",credentials:"include"});if(200===t.status)return t.json()}catch(t){this.logger.error("Fetching identity data failed",t)}return this.createFallbackResponse()}))}postData(e){return(0,t.sH)(this,void 0,void 0,(function*(){const t={ppid:e.ppid},n=this.identityServiceUrl+"identity";try{const e=yield this.httpClient.put(n,t,{mode:"cors",credentials:"include"});if(202===e.status)return e.json()}catch(t){this.logger.error("Synchronizing identity data failed",t)}return Object.assign(Object.assign({},e),{synced:!1})}))}getLocalData(){return this.storage.getItem(this.IdentityStorageKey)}setLocalData(t){this.storage.setItem(this.IdentityStorageKey,t)}createFallbackResponse(){return{synced:!1,ppid:this.uuid()}}};Ve=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"UserIdentity")),(0,t.Qj)(1,(0,e.WQ)(l.kk)),(0,t.Qj)(2,(0,e.WQ)(Ue)),(0,t.Qj)(3,(0,e.WQ)(h)),(0,t.Qj)(4,(0,e.WQ)(c))],Ve);let Fe=class{constructor(t,e){this.instantConfigService=t,this.identityStorageClient=e}get(){return(0,t.sH)(this,void 0,void 0,(function*(){const t=this.identityStorageClient.getLocalData();if(t&&!t.synced&&this.shouldRetryIdentitySync(t))this.setRemote(t).catch((t=>{b(t)}));else if(!t||this.isIdentityDeprecated(t))return this.getRemote();return t}))}isIdentityDeprecated(t){const e=this.instantConfigService.get("icIdentityTtl",6048e5),n=Date.now()-e;return!t.timestamp||t.timestamp<n}shouldRetryIdentitySync(t){const e=Date.now()-36e5;return!t.lastSyncAttemptTimestamp||t.lastSyncAttemptTimestamp<e}getRemote(){return(0,t.sH)(this,void 0,void 0,(function*(){const t=yield this.identityStorageClient.fetchData();return this.identityStorageClient.setLocalData(Object.assign(Object.assign({},t),{timestamp:Date.now()})),t}))}setRemote(e){return(0,t.sH)(this,void 0,void 0,(function*(){const t=yield this.identityStorageClient.postData(e),n=this.identityStorageClient.getLocalData();this.identityStorageClient.setLocalData(Object.assign({ppid:n.ppid,synced:t.synced,timestamp:Date.now()},t.synced?{}:{lastSyncAttemptTimestamp:Date.now()}))}))}};Fe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(ge)),(0,t.Qj)(1,(0,e.WQ)(Ve))],Fe);let Be=class{constructor(t,e){this.logger=t,this.identityStorageService=e}get(){return(0,t.sH)(this,void 0,void 0,(function*(){const t=yield this.identityStorageService.get();return this.logger.info(t),t.ppid}))}};Be=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"UserIdentity")),(0,t.Qj)(1,(0,e.WQ)(Fe))],Be);let He=class{constructor(t,e,n){this.logger=t,this.uuid=e,this.storage=n}get(){return Promise.resolve(this.storage.getItem("ppid")||this.generatePPID())}generatePPID(){this.logger.info("did not found a PPID in LocalStorage");const t=this.uuid();return this.storage.setItem("ppid",t),t}};He=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"UserIdentity")),(0,t.Qj)(1,(0,e.WQ)(l.kk)),(0,t.Qj)(2,(0,e.WQ)(Ue))],He);let $e=class{constructor(t,e,n,i,r,o,s){this.dataWarehouse=t,this.logger=e,this.windowContextRepository=n,this.instantConfigService=i,this.identityStorageRepository=r,this.localStorageRepository=o,this.communicationService=s}getPPID(t){switch(this.logger.info("active strategy: ",t),t){case Le.IDENTITY_STORAGE:return this.identityStorageRepository;case Le.LOCAL:default:return this.localStorageRepository}}generatePPID(){return(0,t.sH)(this,void 0,void 0,(function*(){try{const t=this.instantConfigService.get("icPpidRepository",Le.LOCAL),e=yield this.getPPID(t).get();this.dataWarehouse.track(st.identity,{partner_name:"Google",partner_identity_id:e}),this.communicationService.emit(new k(j,{payload:{partnerName:"Google",partnerIdentityId:e}})),this.windowContextRepository.set(je.tracking,"ppid",e),this.logger.info("Passed PPID to page-level targeting")}catch(t){this.logger.error("Setting up PPID has failed!",t)}}))}setPpid(){return(0,t.sH)(this,void 0,void 0,(function*(){this.instantConfigService.get("icPpid",!1)?(this.logger.info("enabled - awaiting setup"),yield this.generatePPID()):this.logger.info("disabled")}))}};$e=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(ve)),(0,t.Qj)(1,(0,e.MR)(s.V,s.O,"UserIdentity")),(0,t.Qj)(2,(0,e.WQ)(Ee)),(0,t.Qj)(3,(0,e.WQ)(ge)),(0,t.Qj)(4,(0,e.WQ)(Be)),(0,t.Qj)(5,(0,e.WQ)(He)),(0,t.Qj)(6,(0,e.WQ)(K))],$e);let qe=class{constructor(t,e,n,i,r){this.platform=e,this.window=n,this.httpClient=i,this.logger=r,this.enabled=!1,this.monitoringBaseUrl=`${t.get()}adeng/api/identity/meters/`}isReportingEnabled(t){const e=t.get("icMonitorTrafficThreshold",{identity:0});return!!(0,pe.A)()||"object"==typeof(n=e)&&!Array.isArray(n)&&null!==n&&(null==e?void 0:e.identity)>0&&e.identity>=100*Math.random();var n}init(t){var e;this.enabled=this.isReportingEnabled(t),this.logger.info(`Metric reporter enabled: ${this.enabled}`),this.enabled&&("complete"===this.window.document.readyState?this.reportPerformanceMetrics():null===(e=this.window)||void 0===e||e.addEventListener("load",(()=>this.reportPerformanceMetrics())))}reportIdentityEngineState(t){this.enabled&&this.reportTimedAction(t)}reportConsentEvent(t){this.enabled&&this.reportAction("opt"+(t?"in":"out"))}reportPerformanceMetrics(){const t=this.window.performance.getEntriesByType("navigation");if(t.length>0){const e=t[0].domContentLoadedEventEnd,n=t[0].loadEventEnd;this.reportTimedAction("document_content_loaded",Math.round(e>0?e:this.logger.getTimeDelta())),this.reportTimedAction("document_load_time",Math.round(n>0?n:this.logger.getTimeDelta()))}}send(t,e,n){if(!this.enabled)return;const i=new URL(t,this.monitoringBaseUrl);i.searchParams.set("app",this.platform.get()),i.searchParams.set("action",e),Object.entries(n).forEach((([t,e])=>i.searchParams.set(t,e))),this.httpClient.get(i.toString(),{mode:"cors"},2e3).catch((()=>{this.logger.error("Failed to send data")}))}reportAction(t){this.enabled&&this.send("counter",t,{})}reportTimedAction(t,e){if(!this.enabled)return;const n={value:e?e.toString():Math.round(this.logger.getTimeDelta()).toString()};this.send("histogram",t,n)}};qe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(h)),(0,t.Qj)(1,(0,e.WQ)(v)),(0,t.Qj)(2,(0,e.WQ)(l.jf)),(0,t.Qj)(3,(0,e.WQ)(c)),(0,t.Qj)(4,(0,e.MR)(s.V,s.O,"MetricReporterService"))],qe);let Ke=class{constructor(t){this.storageAdapter=new Ne(t.sessionStorage)}getItem(t){return this.storageAdapter.getItem(t)}setItem(t,e){try{this.storageAdapter.setItem(t,e)}catch(t){}}removeItem(t){return this.storageAdapter.removeItem(t)}};Ke=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf))],Ke);let ze=class{constructor(t,e,n,i,r,o){this.assetLoader=t,this.window=e,this.instantConfigService=n,this.dataWarehouse=i,this.logger=r,this.metricReporter=o,this.partnerName="liveConnect",this.liveConnectScriptUrl="https://b-code.liadm.com/a-07ev.min.js",this.fallbackQf="0.3",this.live_connect_tracking_events={LIVE_CONNECT_STARTED:"live_connect_started",LIVE_CONNECT_CACHED:"live_connect_cached",LIVE_CONNECT_RESPONDED_UUID:"live_connect_responded_uuid"},this.idConfigMapping=[{id:"unifiedId",name:`${this.partnerName}-unifiedId`},{id:"sha2",name:this.partnerName,params:{qf:"0.3",resolve:"sha2"}},{id:"md5",name:`${this.partnerName}-md5`,params:{qf:"0.3",resolve:"md5"}},{id:"sha1",name:`${this.partnerName}-sha1`,params:{qf:"0.3",resolve:"sha1"}}]}isEnabled(){const{ready:t,blocking:e,coppa:n,optOut:i}=this.window.fandomCmp;return t&&!e&&!n&&!i&&this.instantConfigService.get("icLiveConnect")&&this.instantConfigService.get("icLiveConnectCachingStrategy")&&this.instantConfigService.get("icIdentityPartners")}init(){return(0,t.sH)(this,void 0,void 0,(function*(){this.isEnabled()?(this.setupStorage(),this.shouldLoadScript()?(this.logger.info("loading"),this.dataWarehouse.track(st.loadTime,this.live_connect_tracking_events.LIVE_CONNECT_STARTED),this.assetLoader.loadScript(this.liveConnectScriptUrl,"text/javascript",!1).then((()=>{this.logger.info("loaded"),this.resolveAndTrackIds(),this.logEvent("live-connect-requested")}))):(this.dataWarehouse.track(st.loadTime,this.live_connect_tracking_events.LIVE_CONNECT_CACHED),this.logger.info(`already loaded and available in ${this.storageConfig.type}Storage`))):this.logger.info("disabled")}))}resolveAndTrackIds(){var t;if(!this.window.liQ)return void this.logger.warn("window.liQ not available for tracking");const e=null===(t=this.instantConfigService.get("icLiveConnectQf"))||void 0===t?void 0:t.toString();this.window.liQ.resolve((t=>{this.trackIds(t)}),(t=>{console.error(t)}),{qf:e||this.fallbackQf,resolve:this.idConfigMapping.map((t=>t.id))})}trackIds(t){this.logger.info("resolve response:",t),Object.keys(t).forEach((e=>{if(!t[e])return;const n=this.getTrackingKeyName(e);if(this.isAvailableInStorage(n))return;"unifiedId"===e&&this.dataWarehouse.track(st.loadTime,this.live_connect_tracking_events.LIVE_CONNECT_RESPONDED_UUID);const i=t[e];this.logger.info(`${e}: ${i}`),i&&(this.storage.setItem(n,i,this.storageConfig.ttl),this.dataWarehouse.track(st.identity,{partner_name:n,partner_identity_id:i}))}))}getTrackingKeyName(t){var e;return null===(e=this.idConfigMapping.find((e=>e.id===t)))||void 0===e?void 0:e.name}setupStorage(){this.storageConfig=this.instantConfigService.get("icLiveConnectCachingStrategy"),"local"===this.storageConfig.type?this.storage=new Ue(this.window):this.storage=new Ke(this.window)}shouldLoadScript(){var t;if(!this.storageConfig)return!0;let e=!1;for(const n of this.storageConfig.mandatoryParams){const i=null===(t=this.idConfigMapping.find((t=>t.id===n)))||void 0===t?void 0:t.name;if(!this.isAvailableInStorage(i)){e=!0;break}}return e}isAvailableInStorage(t){return!!this.storage.getItem(t)}logEvent(t){this.metricReporter.reportTimedAction(t)}};ze=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(X)),(0,t.Qj)(1,(0,e.WQ)(l.jf)),(0,t.Qj)(2,(0,e.WQ)((0,e.cb)((()=>ge)))),(0,t.Qj)(3,(0,e.WQ)(ve)),(0,t.Qj)(4,(0,e.MR)(s.V,s.O,"liveConnect")),(0,t.Qj)(5,(0,e.WQ)(qe))],ze);let Ze=class{constructor(t,e,n){this.logger=t,this.contextRepository=e,this.liveConnect=n}createPartnersContext(){const t=this.contextRepository.get(je.tracking,"ppid");t&&this.contextRepository.set(je.partners,"anyclip",{ppid:t})}initializeTargetingPartners(){return(0,t.sH)(this,void 0,void 0,(function*(){}))}initializeTrackingPartners(){return(0,t.sH)(this,void 0,void 0,(function*(){this.logger.info("Initializing partners"),yield Promise.all([this.liveConnect.init()])}))}};Ze=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"Partners")),(0,t.Qj)(1,(0,e.WQ)(Ee)),(0,t.Qj)(2,(0,e.WQ)(ze))],Ze);let Je=class{constructor(t,e,n,i){this.logger=t,this.windowContextRepository=e,this.dataWarehouse=n,this.navigator=i}init(){return(0,t.sH)(this,void 0,void 0,(function*(){var t;if(this.logger.info("FacilitatedTesting init"),null===(t=this.navigator.cookieDeprecationLabel)||void 0===t?void 0:t.getValue){const t=yield this.navigator.cookieDeprecationLabel.getValue();t?(this.logger.info(`Received cookieDeprecationLabel: ${t}`),this.windowContextRepository.set(je.tracking,"chromeLabel",t),this.dataWarehouse.track(st.chromeLabel,t)):this.logger.info("Received empty cookieDeprecationLabel")}else this.logger.info("cookieDeprecationLabel not available")}))}};Je=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"GooglePrivacySandbox:FacilitatedTesting")),(0,t.Qj)(1,(0,e.WQ)(Ee)),(0,t.Qj)(2,(0,e.WQ)(ve)),(0,t.Qj)(3,(0,e.WQ)(l.kW))],Je);let Ye=class{constructor(t,e){this.logger=t,this.facilitatedTesting=e}init(){this.logger.info("GooglePrivacySandbox init"),this.facilitatedTesting.init()}};Ye=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.MR)(s.V,s.O,"GooglePrivacySandbox")),(0,t.Qj)(1,(0,e.WQ)(Je))],Ye);let Xe=class{constructor(t,e,n,i){this.window=t,this.contextRepository=e,this.browser=n,this.platform=i}init(){const{ready:t,coppa:e,optOut:n}=this.window.fandomCmp;!t||e||n||(this.setAdTargetingGroup(),this.setBrowser()),this.setBrand()}setBrowser(){this.contextRepository.set(je.targeting,"browser",this.browser.getBrowser().split(" ")[0])}setBrand(){let t=this.platform.get();t!==f.FANDOMDESKTOP&&t!==f.FANDOMMOBILE&&t!==f.F2||(t="fandom"),t===f.METACRITIC_NEUTRON&&(t=f.METACRITIC),t===f.TVGUIDE_MTC&&(t=f.TVGUIDE),this.contextRepository.set(je.targeting,"brand",t)}getRandomGroup(){return 5*Math.ceil(Math.random()%20*20)}setAdTargetingGroup(){const t=this.getRandomGroup(),e=Array.from({length:21},((t,e)=>100-5*e)).filter((e=>e>=t&&e>0));this.contextRepository.set(je.targeting,"adGroup",e.toString())}};Xe=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf)),(0,t.Qj)(1,(0,e.WQ)(Ee)),(0,t.Qj)(2,(0,e.WQ)(m)),(0,t.Qj)(3,(0,e.WQ)(v))],Xe);let tn=class{constructor(t,e,n){this.partnersService=t,this.adTargetingGroups=e,this.logger=n}initializeTargeting(){return(0,t.sH)(this,void 0,void 0,(function*(){this.logger.info("Setting up targeting"),yield this.partnersService.initializeTargetingPartners(),this.adTargetingGroups.init()}))}};tn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(Ze)),(0,t.Qj)(1,(0,e.WQ)(Xe)),(0,t.Qj)(2,(0,e.MR)(s.V,s.O,"TargetingService"))],tn);class en{constructor(t,e){this.window=t,this.logger=e,this.queue=[]}install(){this.logger.info("installing consent queue");const t=this;return this.window.consentCallbackQueue=this,this.window.consentCallback=(e,n,i)=>t.push(e,n,i),this}push(t,e,n){this.logger.warn("dialog not resolved, enqueued:",t),this.queue.push({name:t,callback:e,category:n})}}const nn={C0001:"necessary",C0002:"performance",C0003:"functional",C0004:"targeting",C0005:"social"};class rn{constructor(t,e){this.container=t;const n=t.OptanonWrapper;t.OptanonWrapper=()=>{e.resolve(),null==n||n()}}available(){return void 0!==this.container.OneTrust}ready(){var t,e;const n=this.container.OneTrust;return void 0!==this.container.OnetrustActiveGroups&&("opt-in"!==(null===(e=null===(t=n.GetDomainData())||void 0===t?void 0:t.ConsentModel)||void 0===e?void 0:e.Name)||n.IsAlertBoxClosed())}resolve(){var t;return null===(t=this.container.OnetrustActiveGroups)||void 0===t?void 0:t.split(",").map((t=>nn[t])).filter((t=>t)).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:!0})),{})}}class on{constructor(t,e){this.optIn=t,this.cookiesManager=e}available(){return void 0!==this.cookiesManager.get("OptanonConsent")}ready(){return!this.optIn||void 0!==this.cookiesManager.get("OptanonAlertBoxClosed")}resolve(){var t;const e=null===(t=decodeURIComponent(this.cookiesManager.get("OptanonConsent")))||void 0===t?void 0:t.match(/groups=([^&]+)/);return e&&e[1]?e[1].toUpperCase().split(",").map((t=>{const e=t.split(":");return"1"===e[1]?nn[e[0]]:void 0})).filter((t=>t)).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:!0})),{}):{}}}const sn={necessary:!0},an={necessary:!0,performance:!0,functional:!0,targeting:!0,social:!0};let cn=class{constructor(t,e,n,i){this.container=t,this.logger=e,this.geo=n,this.cookiesManager=i,this.queue=t.consentCallbackQueue,this.optIn=!!n&&Z.e.includes(this.geo.getCountryCode()),void 0!==this.queue&&this.init()}resolve(){return!!this.wasResolved()||(this.ifAvailableThenResolveIfReady(this.apiConsentResolver)?(this.logger.info("API available, resolved?:",this.categories),this.wasResolved()):!!this.ifAvailableThenResolveIfReady(this.cookieConsentResolver)&&(this.logger.info("Cookies available, resolved?:",this.categories),this.wasResolved()))}wasResolved(){return void 0!==this.categories}init(){this.logger.info("Setting up with opt-in status:",this.optIn),this.apiConsentResolver=new rn(this.container,this),this.cookieConsentResolver=new on(this.optIn,this.cookiesManager),this.resolve()||setTimeout((()=>this.resolveWithFallback()),5e3)}resolveWithFallback(){this.resolve()||(this.apiConsentResolver.available()||this.cookieConsentResolver.available()?(this.logger.info("Still waiting for consent resolve with available api:",this.apiConsentResolver.available(),"or cookie:",this.cookieConsentResolver.available()),setTimeout((()=>this.resolveWithFallback),5e3)):(this.categories=this.fallback(),this.logger.info("Unable to resolve consent, fallback to:",this.categories),this.resolveQueue()))}ifAvailableThenResolveIfReady(t){const e=t.available();return e&&t.ready()&&(this.categories=t.resolve(),this.resolveQueue()),e}checkAndRun(t,e,n){return this.logger.info("About to callback:",t,"for:",n,"with:",this.categories),!(void 0!==n&&!this.categories[n]||(e(this.categories),0))}resolveQueue(){this.flushQueue(),this.queue.push=(t,e,n)=>this.checkAndRun(t,e,n),this.container.consentCallback=(t,e,n)=>this.checkAndRun(t,e,n)}flushQueue(){const t=this.queue.queue;this.logger.info("Consent resolved, flushing queue of size:",t.length);for(let e=t.length-1;e>=0;e--){const n=t[e];this.checkAndRun(n.name,n.callback,n.category)&&t.splice(e,1)}}fallback(){return this.optIn?sn:an}};cn=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(l.jf)),(0,t.Qj)(1,(0,e.MR)(s.V,s.O,"ConsentCallbackQueueHandler")),(0,t.Qj)(2,(0,e.WQ)(d.u)),(0,t.Qj)(3,(0,e.WQ)(l.AZ))],cn),e.kL.register(l.AZ,{useValue:o}),e.kL.register(l.kk,{useValue:function(){return"randomUUID"in crypto||(crypto.randomUUID=()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))),crypto.randomUUID()}}),e.kL.register(l.kW,{useValue:navigator}),e.kL.register(l.jf,{useValue:window}),e.kL.register(en,{useFactory:(0,e.TS)((t=>new en(t.resolve(l.jf),t.resolve(s.V).setLoggerGroup("ConsentCallbackQueue"))))});let ln=class{constructor(t,e,n,i,r,o,s,a,c,l,d,u,h,g,p){this.geoCookie=t,this.communicationService=e,this.optInService=n,this.hemTrackingService=i,this.trackingContextSetupService=r,this.instantConfigService=o,this.window=s,this.logger=a,this.ppidProvider=c,this.metricReporterService=l,this.partnersService=d,this.googlePrivacySandbox=u,this.targetingService=h}init(){return(0,t.sH)(this,void 0,void 0,(function*(){yield this.geoCookie.setGeoCookieIfNotExist(),yield this.instantConfigService.init(this.communicationService),this.optInService.init(this.instantConfigService),this.metricReporterService.init(this.instantConfigService),this.metricReporterService.reportIdentityEngineState("init")}))}run(){var t,e;this.logger.info("Starting identity engine",`version: ${function(t){var e,n;return null===(n=null===(e=null==t?void 0:t.replace("/identity-service/",""))||void 0===e?void 0:e.replace("/index.js",""))||void 0===n?void 0:n.replace(/^v/,"")}(null===(e=null===(t=this.window.ads)||void 0===t?void 0:t.version)||void 0===e?void 0:e.identity)}`),this.optInService.onReady().then((()=>{this.trackingContextSetupService.setup();const{ready:t,blocking:e,optOut:n}=this.window.fandomCmp,i=t&&!e&&!n;this.metricReporterService.reportConsentEvent(i),this.updateGTMConsent(i),this.initializeTargeting(),i?this.initializeTracking():(this.loadPhoenixThirdPartyDisabledMode(),this.logger.info("Tracking rejected")),this.communicationService.emit(new k(O)),this.metricReporterService.reportIdentityEngineState("ready")}))}updateGTMConsent(t){void 0===this.window.dataLayer&&(this.window.dataLayer=[]),this.window.dataLayer.push({event:"user-consent",consent:t.toString()})}initializeTracking(){return(0,t.sH)(this,void 0,void 0,(function*(){this.logger.info("Setting up tracking"),this.hemTrackingService.activateTracking(),yield this.ppidProvider.setPpid(),yield this.partnersService.initializeTrackingPartners(),this.partnersService.createPartnersContext(),this.googlePrivacySandbox.init()}))}initializeTargeting(){return(0,t.sH)(this,void 0,void 0,(function*(){yield this.targetingService.initializeTargeting()}))}loadPhoenixThirdPartyDisabledMode(){var t;(null===(t=null===window||void 0===window?void 0:window.PhoenixLoader)||void 0===t?void 0:t.triggerEvent)?(this.logger.info("Load third party in disabled mode"),window.PhoenixLoader.triggerEvent("loadThirdPartyDisabled")):this.logger.info("No PhoenixLoader.triggerEvent defined")}};ln=(0,t.Cg)([(0,e.Gr)(),(0,t.Qj)(0,(0,e.WQ)(p)),(0,t.Qj)(1,(0,e.WQ)(K)),(0,t.Qj)(2,(0,e.WQ)(Pe)),(0,t.Qj)(3,(0,e.WQ)(xe)),(0,t.Qj)(4,(0,e.WQ)(Ge)),(0,t.Qj)(5,(0,e.WQ)(ge)),(0,t.Qj)(6,(0,e.WQ)(l.jf)),(0,t.Qj)(7,(0,e.MR)(s.V,s.O,"IdentityEngine")),(0,t.Qj)(8,(0,e.WQ)($e)),(0,t.Qj)(9,(0,e.WQ)(qe)),(0,t.Qj)(10,(0,e.WQ)(Ze)),(0,t.Qj)(11,(0,e.WQ)(Ye)),(0,t.Qj)(12,(0,e.WQ)(tn)),(0,t.Qj)(13,(0,e.WQ)(en)),(0,t.Qj)(14,(0,e.WQ)(cn))],ln),function(){(0,t.sH)(this,void 0,void 0,(function*(){void 0===window.fandomCmp&&(window.fandomCmp={ready:!1,blocking:!1,coppa:!1,optOut:!1});try{const t=e.kL.resolve(ln);yield t.init(),t.run()}catch(t){b(t)}}))}()})()})();
//# sourceMappingURL=index.js.map